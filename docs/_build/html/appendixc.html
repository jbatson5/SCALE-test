

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MAVRIC Appendix C: Advanced Features &mdash; SCALE Manual 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Monte Carlo Transport Overview" href="Monte%20Carlo%20Transport%20Overview.html" />
    <link rel="prev" title="MAVRIC Appendix B: MAVRIC Utilities" href="appendixb.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> SCALE Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Radiation Shielding</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="MAVRIC.html">MAVRIC: Monaco with Automated Variance Reduction using Importance Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="CAAScapability.html">MAVRIC Appendix A: CAAS Capability</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixb.html">MAVRIC Appendix B: MAVRIC Utilities</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MAVRIC Appendix C: Advanced Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#alternate-normalization-of-the-importance-map-and-biased-source">Alternate normalization of the importance map and biased source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#importance-maps-with-directional-information">Importance maps with directional information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#approaches-incorporating-directional-information">Approaches incorporating directional information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directionally-dependent-weight-windows-without-directional-source-biasing">Directionally dependent weight windows without directional source biasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directionally-dependent-weight-windows-with-directional-source-biasing">Directionally dependent weight windows with directional source biasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-space-energy-angle-cadis-in-mavric">Using space/energy/angle CADIS in MAVRIC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-problem">Example problem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#university-of-michigan-methods-for-global-variance-reduction">University of Michigan methods for global variance reduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#weight-windows-using-only-forward-estimates-of-flux">Weight windows using only forward estimates of flux</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#global-flux-weight-windows">Global flux weight windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#global-response-weight-windows">Global response weight windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-in-mavric">Implementation in MAVRIC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#methods-using-forward-and-adjoint-estimates">Methods using forward and adjoint estimates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#source-detector-problems">Source/detector problems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-region-problems">Source-region problems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#global-response-problem">Global response problem</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Implementation in MAVRIC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-problems">Example problems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-global-problem">A global problem</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#other-special-options-for-the-importance-map-block-input">Other special options for the importance map block input</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-mavric-to-run-fixed-source-denovo-calculations">Using MAVRIC to run fixed-source Denovo calculations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#optional-denovo-parameters">Optional Denovo parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#forward-source-preparations">Forward source preparations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjoint-source-preparation">Adjoint source preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-notes">Other notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mavric-utilities-for-denovo">MAVRIC utilities for Denovo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Example problem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#forward">Forward</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adjoint">Adjoint</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Monte Carlo Transport</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Monte%20Carlo%20Transport%20Overview.html">Monte Carlo Transport Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Keno.html">Keno: A Monte Carlo Criticality Program</a></li>
<li class="toctree-l1"><a class="reference internal" href="Monaco.html">Monaco: A Fixed-Source Monte Carlo Transport Code for Shielding Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Criticality Safety</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Criticality%20Safety%20Overview.html">Criticality Safety Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="CSAS5.html">CSAS5:  Control Module For Enhanced Criticality Safety Analysis Sequences With KENO V.a</a></li>
<li class="toctree-l1"><a class="reference internal" href="CSAS5App.html">Additional Example Applications of CSAS5</a></li>
<li class="toctree-l1"><a class="reference internal" href="CSAS6.html">CSAS6:  Control Module for Enhanced Criticality Safety Analysis with KENO-VI</a></li>
<li class="toctree-l1"><a class="reference internal" href="CSAS6App.html">Additional Example Applications of CSAS6</a></li>
<li class="toctree-l1"><a class="reference internal" href="STARBUCS.html">STARBUCS: A Scale Control Module for Automated Criticality Safety Analyses Using Burnup Credit</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sourcerer.html">Sourcerer: Deterministic Starting Source for Criticality Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="DEVC.html">DEVC: Denovo EigenValue Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="KMART.html">KMART5 and KMART6: Postprocessors for KENO V.A and KENO-VI</a></li>
<li class="toctree-l1"><a class="reference internal" href="K5C5.html">K5toK6 and C5toC6: Input File Conversion Programs for KENO and CSAS</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SCALE Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>MAVRIC Appendix C: Advanced Features</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/appendixc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mavric-appendix-c-advanced-features">
<span id="appendixc"></span><h1>MAVRIC Appendix C: Advanced Features<a class="headerlink" href="#mavric-appendix-c-advanced-features" title="Permalink to this headline">¶</a></h1>
<p>This appendix contains information on several advanced features that are
still under development or are non-standard use of the MAVRIC sequence.</p>
<div class="section" id="alternate-normalization-of-the-importance-map-and-biased-source">
<h2>Alternate normalization of the importance map and biased source<a class="headerlink" href="#alternate-normalization-of-the-importance-map-and-biased-source" title="Permalink to this headline">¶</a></h2>
<p>The importance map and biased source implemented in MAVRIC are only
functions of space and energy. The importance for a specific location
and energy represents the average over all directions. For applications
involving a collimated beam source, a space/energy importance map may
not be representative of the true importance of the particles as they
stream away from the source.</p>
<p>As an example, consider a 14.1 MeV active interrogation beam source 1
meter from a small spherical boat containing illicit nuclear material.
The objective is to compute the fission rate in the nuclear material. To
create the biasing parameters, an adjoint source is located within the
nuclear material and the resulting importance map is shown in
<a class="reference internal" href="#fig4c1"><span class="std std-numref">Fig. 48</span></a>. Note that in both the air and water, the importances
change with distance from the ship, but for the beam source, the
importance (to causing a fission in the nuclear material) anywhere along
the beam should be the same, since there is little chance a 14.1 MeV
neutron will interact with the air before striking the ship.</p>
<div class="figure align-center" id="id13">
<span id="fig4c1"></span><img alt="_images/fig41c.png" src="_images/fig41c.png" />
<p class="caption"><span class="caption-number">Fig. 48 </span><span class="caption-text">Importance map computed using standard CADIS.</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</div>
<p>The CADIS algorithm has done exactly what it was supposed to: it made a
space/energy importance map and normalized it such that the target
weight where the 14.1 MeV source particles are born is 1. The problem
with this is that the source particles will stream towards the ship and
strike the hull where the target weight is 0.092. Since source particles
have little chance of interacting in the air, the weight windows are not
used to split the particle as they travel towards the ship. When source
particles cross into the ship, they are split by a factor of 11 to match
the target weight. For this example, splitting each particle by a factor
of 11 once they strike the ship is not so bad, but for longer distances,
this will result in much larger splits. For a polyenergetic source, this
could lead to undersampling of the source and could result in higher
variances.</p>
<p>To remedy this problem when using beam sources, the normalization of the
importance map and biased source should not be done at the source
location but instead at the point where the source particles first
interact with the ship. The keyword “shiftNormPos Δx Δy Δz” will shift
the source normalization position by the amounts Δx, Δy, and Δz when the
biased source and importance map are developed. For the Monaco Monte
Carlo calculation, the source is returned to its normal position. The
source input for the above problem would then be</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">sources</span>
    <span class="err">src</span> <span class="m">1</span>
        <span class="err">title=</span><span class="s">&quot;14.1 DT neutrons - collimated&quot;</span>
        <span class="err">strength</span><span class="m">=1e30</span>
        <span class="err">sphere</span> <span class="m">0</span> <span class="err">origin</span> <span class="err">x=-</span><span class="m">195</span> <span class="err">y=</span><span class="m">0</span> <span class="err">z=</span><span class="m">0</span>   <span class="err">(true</span> <span class="err">source</span> <span class="err">position)</span>
        <span class="err">eDistributionID=</span><span class="m">1</span>    <span class="err">(a</span> <span class="err">mono-energetic</span> <span class="m">14</span><span class="err">.</span><span class="m">1</span> <span class="err">MeV</span> <span class="err">distribution)</span>
        <span class="err">direction</span> <span class="m">1</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span>
        <span class="err">dDistributionID=</span><span class="m">2</span>    <span class="err">(a</span> <span class="m">2</span><span class="err">°</span> <span class="err">beam</span> <span class="err">)</span>
        <span class="err">shiftNormPos</span> <span class="m">107</span><span class="err">.</span><span class="m">7</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span>    <span class="err">(just</span> <span class="err">inside</span> <span class="err">the</span> <span class="err">hull)</span>
    <span class="n">end</span><span class="err"> </span><span class="n">src</span>
<span class="n">end</span><span class="err"> </span><span class="n">sources</span>
</pre></div>
</div>
<p>where the shift moves the source position from x = -195 to x = -87.3,
just inside the hull. The resulting target weights are shown in
<a class="reference internal" href="#fig4c2"><span class="std std-numref">Fig. 49</span></a> The source particles are born with weight 1 in a
location with a target weight 10.9. The particle weight is not checked
until the particle crosses into the hull, where the target weight is
1.0.</p>
<div class="figure align-center" id="id14">
<span id="fig4c2"></span><img alt="_images/fig4c2.png" src="_images/fig4c2.png" />
<p class="caption"><span class="caption-number">Fig. 49 </span><span class="caption-text">Targets weights using the “shiftNormPos” keyword.</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</div>
<p>Other options to manipulate the importance map for special situations
include the “mapMultiplier=<em>f</em>” keyword (in the importanceMap block
or the biasing block), which will multiply every target weight by the
factor <em>f</em>, and the keyword “noCheckAtBirth” in the parameters block
will prevent the weight windows from being applied to source particles
when they are started. When used in the MAVRIC sequence, the
“shiftNormPos” capability automatically adds “noCheckAtBirth” to the
Monaco input that is created.</p>
</div>
<div class="section" id="importance-maps-with-directional-information">
<h2>Importance maps with directional information<a class="headerlink" href="#importance-maps-with-directional-information" title="Permalink to this headline">¶</a></h2>
<p>In MAVRIC, the CADIS method is implemented in space and energy, but in
general, it could also include particle direction as well. This
formulation would be the following:</p>
<blockquote>
<div><dl>
<dt>True source:</dt><dd><div class="math notranslate nohighlight">
\[q\left( \overrightarrow{r},E,\widehat{\Omega} \right)\]</div>
</dd>
<dt>Desired response:</dt><dd><div class="math notranslate nohighlight">
\[\sigma\left( \overrightarrow{r},E,\widehat{\Omega}\right)\]</div>
</dd>
<dt>Adjoint flux using  <span class="math notranslate nohighlight">\(q^{+}\left( \overrightarrow{r},E,\widehat{\Omega} \right) = \ \sigma \left( \overrightarrow{r},E,\widehat{\Omega} \right)\)</span>:</dt><dd><div class="math notranslate nohighlight">
\[\psi^{+}\left( \overrightarrow{r},E,\widehat{\Omega} \right)\]</div>
</dd>
<dt>Estimate of detector response</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c1">
<span class="eqno">(25)<a class="headerlink" href="#equation-eq4c1" title="Permalink to this equation">¶</a></span>\[R = \iiint_{}^{}{q\left( \overrightarrow{r},E,\widehat{\Omega} \right)\ \psi^{+}\left( \overrightarrow{r},E,\widehat{\Omega}\right)}d\text{Ω } dE \ dV\]</div>
</dd>
<dt>Biased source:</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c2">
<span class="eqno">(26)<a class="headerlink" href="#equation-eq4c2" title="Permalink to this equation">¶</a></span>\[\widehat{q}\left( \overrightarrow{r},E,\widehat{\Omega} \right) = \frac{1}{R}q\left( \overrightarrow{r},E,\widehat{\Omega} \right)\ \psi^{+}\left( \overrightarrow{r},E,\widehat{\Omega} \right)\]</div>
</dd>
<dt>Target weight windows:</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c3">
<span class="eqno">(27)<a class="headerlink" href="#equation-eq4c3" title="Permalink to this equation">¶</a></span>\[\overline{w}\left( \overrightarrow{r},E,\widehat{\Omega} \right) = \frac{R}{\psi^{+}\left( \overrightarrow{r},E,\widehat{\Omega} \right)}\]</div>
</dd>
</dl>
</div></blockquote>
<p>For a system using a deterministic method to compute the adjoint fluxes,
this completely general, space/energy/angle, approach presents many
difficulties in implementation, namely,</p>
<ol class="loweralpha simple">
<li><p>dealing with the amount of memory required for a
<span class="math notranslate nohighlight">\(\left( \overrightarrow{r},E,\widehat{\Omega} \right)\)</span>
importance map in memory,</p></li>
<li><p>interpolating the importance for particle directions in between
quadrature angles, and</p></li>
<li><p>expressing the biased source in a form suitable for a general MC code
since the above biased source is, in general, not separable.</p></li>
</ol>
<div class="section" id="approaches-incorporating-directional-information">
<h3>Approaches incorporating directional information<a class="headerlink" href="#approaches-incorporating-directional-information" title="Permalink to this headline">¶</a></h3>
<p>Completely general space/energy/angle CADIS is most likely too difficult
to implement and may not be necessary for most applications. In most
real problems that involve directionally dependent source distributions,
the directional dependence is azimuthally symmetric about some reference
direction, <span class="math notranslate nohighlight">\(\widehat{d}\)</span>. The angular distribution,
<span class="math notranslate nohighlight">\(q_{i}\left( \widehat{\Omega} \right)\)</span>, can be expressed as the
product of the uniform azimuthal distribution and a polar distribution
about reference direction <span class="math notranslate nohighlight">\({\widehat{d}}_{i}\)</span> giving
<span class="math notranslate nohighlight">\(\frac{1}{2\pi}q_{i}\left( \widehat{\Omega} \bullet {\widehat{d}}_{i} \right)\)</span>.
The geometric size of these sources tends to be small, allowing each
source distribution to be expressed as the product of two separable
distributions:
<span class="math notranslate nohighlight">\(q_{i}\left( \overrightarrow{r},E,\widehat{\Omega} \right) \cong q_{i}\left( \overrightarrow{r},E \right)\ q_{i}\left( \widehat{\Omega} \right)\)</span>.</p>
<p>What is needed is a CADIS method that (1) can account for the importance
of a particle traveling in a certain direction; (2) can be cast as a
simple modification of the space/energy CADIS method using
<span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r},E \right)\)</span> and
<span class="math notranslate nohighlight">\(\widehat{q}\left( \overrightarrow{r},E \right)\)</span>; and (3) is
simpler than the full space/angle/energy approach. This can be done
starting with the approximation that the angular component of the
adjoint flux
<span class="math notranslate nohighlight">\(\psi^{+}\left( \overrightarrow{r},E,\widehat{\Omega} \right)\)</span> is
separable and symmetric about the average adjoint current direction
<span class="math notranslate nohighlight">\(\widehat{n}\left( \overrightarrow{r},E \right)\)</span>, such that</p>
<div class="math notranslate nohighlight">
\[\psi^{+}\left( \overrightarrow{r},E,\widehat{\Omega} \right) \cong \phi^{+}\left( \overrightarrow{r},E \right)\ \frac{1}{2\pi}f\left( \widehat{\Omega} \bullet \widehat{n} \right)\text{\ .}\]</div>
<p>This is similar to the AVATAR approach <a class="bibtex reference internal" href="#van-riper-avatar-1997" id="id1">[VRUS97]</a> but with explicitly
including the azimuthal distribution so that the standard definition
<span class="math notranslate nohighlight">\(\int_{}^{}{\phi^{+}\left( \overrightarrow{r},E \right)\ \frac{1}{2\pi}f\left( \widehat{\Omega} \bullet \widehat{n} \right)\ d\widehat{\Omega}} = \phi^{+}\left( \overrightarrow{r},E \right)\)</span>
applies. The probability distribution function
<span class="math notranslate nohighlight">\(f\left( \mu \right)\)</span> describing the shape of the azimuthally
symmetric current at <span class="math notranslate nohighlight">\(\left( \overrightarrow{r},E \right)\)</span> has the
form of</p>
<div class="math notranslate nohighlight">
\[f\left( \mu \right) = \frac{\lambda e^{\text{λμ}}}{2\ \mathrm{\sinh}\left( \lambda \right)}\ ,\]</div>
<p>with the single parameter
<span class="math notranslate nohighlight">\(\lambda\left( \overrightarrow{r},E \right)\)</span> determined from
<span class="math notranslate nohighlight">\(\overline{\mu}\left( \overrightarrow{r},E \right)\)</span>, the average
cosine of scatter.</p>
<p>From this, we can propose that weight window targets be developed that
are inversely proportional to the approximation of the adjoint angular
flux:</p>
<div class="math notranslate nohighlight" id="equation-eq4c4">
<span class="eqno">(28)<a class="headerlink" href="#equation-eq4c4" title="Permalink to this equation">¶</a></span>\[\overline{w}\left( \overrightarrow{r},E,\widehat{\Omega} \right) = \frac{2\pi\ k}{\phi^{+}\left( \overrightarrow{r},E \right) \ \ f\left( \widehat{\Omega} \bullet \widehat{n} \right)}\ ,\]</div>
<p>where <span class="math notranslate nohighlight">\(k\)</span> is the constant of proportionality that will be adjusted
to make the importance map consistent with the biased source(s). Two
methods will be examined here, one without and one with biasing of the
source directional dependence.</p>
<p>For both of the methods, the S<sub>N</sub> code Denovo was modified to
report not only the adjoint scalar fluxes,
<span class="math notranslate nohighlight">\(\phi^{+}\left( \overrightarrow{r},E \right)\)</span>, but also the
adjoint net currents in <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span>, and <span class="math notranslate nohighlight">\(z\)</span> directions:
<span class="math notranslate nohighlight">\(J_{x}\left( \overrightarrow{r},E \right)\)</span>,
<span class="math notranslate nohighlight">\(\ J_{y}\left( \overrightarrow{r},E \right)\)</span>, and
<span class="math notranslate nohighlight">\(J_{z}\left( \overrightarrow{r},E \right)\)</span>. These currents are
used to find <span class="math notranslate nohighlight">\(\widehat{n}\left( \overrightarrow{r},E \right)\)</span> and
<span class="math notranslate nohighlight">\(\lambda\left( \overrightarrow{r},E \right)\)</span>. The following
methods have been developed so that the standard CADIS routines can be
used to compute space/energy quantities of the response per unit source
<span class="math notranslate nohighlight">\(R\)</span>, the weight window target values
<span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r},E \right)\)</span>, and biased
source <span class="math notranslate nohighlight">\(\widehat{q}\left( \overrightarrow{r},E \right)\)</span> with just
the adjoint scalar fluxes. These quantities are then modified by the
directional information.</p>
</div>
<div class="section" id="directionally-dependent-weight-windows-without-directional-source-biasing">
<h3>Directionally dependent weight windows without directional source biasing<a class="headerlink" href="#directionally-dependent-weight-windows-without-directional-source-biasing" title="Permalink to this headline">¶</a></h3>
<p>It is proposed that the biased source
<span class="math notranslate nohighlight">\(\widehat{q}\left( \overrightarrow{r},E,\widehat{\Omega} \right)\)</span>
should be proportional to both the true source distribution and the
space/energy component of the adjoint flux:</p>
<div class="math notranslate nohighlight">
\[\widehat{q}\left( \overrightarrow{r},E,\widehat{\Omega} \right) = \frac{1}{R}\left\lbrack q\left( \overrightarrow{r},E \right)\ \frac{1}{2\pi}q\left( \widehat{\Omega} \bullet \widehat{d} \right) \right\rbrack\ \phi^{+}\left( \overrightarrow{r},E \right)\ ,\]</div>
<p>where the constant of proportionality, <span class="math notranslate nohighlight">\(R\)</span>, is determined by
forcing
<span class="math notranslate nohighlight">\(\widehat{q}\left( \overrightarrow{r},E,\widehat{\Omega} \right)\)</span>
to be a pdf. Since the angular component of the adjoint flux is not
included, the directional distribution of the biased source will be
exactly the same as the true source. Note that this approach would be
exact for cases where no directional biasing could be applied – beam
sources.</p>
<p>For multiple sources (each with a probability distribution function
<span class="math notranslate nohighlight">\(q_{i}\left( \overrightarrow{r},E \right)\)</span> and a strength
<span class="math notranslate nohighlight">\(S_{i}\)</span>, giving a total source strength of
<span class="math notranslate nohighlight">\(S = \sum_{}^{}S_{i}\)</span>), the user is required to provide one point
in phase space
<span class="math notranslate nohighlight">\(\left( {\overrightarrow{r}}_{i},E_{i},{\widehat{\Omega}}_{i} \right)\)</span>
for each source <span class="math notranslate nohighlight">\(i\)</span> that is representative of that entire source
where the biased source will match the target weight windows. For each
source, a vector
<span class="math notranslate nohighlight">\({\widehat{n}}_{i} = \widehat{n}\left( {\overrightarrow{r}}_{i},E_{i} \right)\)</span>
is computed using that point. For the general case of multiple sources,
the biased source sampling distribution, the biased source
distributions, and the weight windows are computed using</p>
<p><span class="math notranslate nohighlight">\(R_{i} =  \iint_{}^{}{q_{i}\left( \overrightarrow{r},E\right)\ \phi^{+}\left( \overrightarrow{r},E \right)} dE \ dr \ \ \ \ \ \ \ \ \  \text{(estimated response from source} \ i)\)</span></p>
<p><span class="math notranslate nohighlight">\(\widehat{p}\left( i \right) = \frac{{S_{i}R}_{i}\ f\left( {\widehat{\Omega}}_{i} \bullet {\widehat{n}}_{i} \right)}{\sum_{}^{}{{S_{i}R}_{i}\ f\left( {\widehat{\Omega}}_{i} \bullet {\widehat{n}}_{i} \right)}} \ \ \ \ \ \ \ \text{(biased sampling of source} \ i)\)</span></p>
<p><span class="math notranslate nohighlight">\({\widehat{q}}_{i}\left(\overrightarrow{r},E,\widehat{\Omega} \right) \ =  \ \frac{1}{R_{i}}q_{i}\left( \overrightarrow{r},E \right)\ \phi^{+}\left( \overrightarrow{r},E \right)\ \frac{1}{2\pi}q_{i}\left( \widehat{\Omega} \bullet {\widehat{d}}_{i} \right) \ = \ {\widehat{q}}_{i}\left( \overrightarrow{r},E\right)\ \frac{1}{2\pi}q_{i}\left( \widehat{\Omega} \bullet {\widehat{d}}_{i} \right)\)</span></p>
<p><span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r},E,\widehat{\Omega} \right) \ \ \ =  \ \ \ \frac{\sum_{}^{}{{S_{i}R}_{i}\ f\left( {\widehat{\Omega}}_{i} \bullet {\widehat{n}}_{i} \right)}}{S\phi^{+}\left( \overrightarrow{r},E \right)}\frac{1}{\ f\left( \widehat{\Omega} \bullet \widehat{n} \right)} \ \ \ = \ \ \  \frac{\sum_{}^{}{{S_{i}R}_{i}\ f\left( {\widehat{\Omega}}_{i} \bullet {\widehat{n}}_{i} \right)}}{\sum_{}^{}{S_{i}R}_{i}}\overline{w}\left( \overrightarrow{r},E \right)\frac{1}{f\left( \widehat{\Omega} \bullet \widehat{n} \right)}\)</span></p>
</div>
<div class="section" id="directionally-dependent-weight-windows-with-directional-source-biasing">
<h3>Directionally dependent weight windows with directional source biasing<a class="headerlink" href="#directionally-dependent-weight-windows-with-directional-source-biasing" title="Permalink to this headline">¶</a></h3>
<p>Here it is proposed that the biased source be proportional to both the
true source distribution and the approximation of the adjoint angular
flux. With a small geometric source, it is also assumed that there is
one vector,
<span class="math notranslate nohighlight">\({\widehat{n}}_{0} = \widehat{n}\left( {\overrightarrow{r}}_{0},E_{0} \right),\)</span>
evaluated at a specific location and energy, which represents the
adjoint current direction over that source. The biased source then looks
like</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}  \widehat{q}\left( \overrightarrow{r},E,\widehat{\Omega} \right) &amp; = \frac{1}{\text{Rc}} q\left( \overrightarrow{r},E,\widehat{\Omega} \right) \ \psi^{+}\left( \overrightarrow{r},E,\widehat{\Omega} \right)\\&amp; = \frac{1}{\text{Rc}}\left\lbrack q\left( \overrightarrow{r},E \right)\ \frac{1}{2\pi}q\left( \widehat{\Omega} \bullet {\widehat{d}}_{i} \right) \right\rbrack\ \left\lbrack \phi^{+}\left( \overrightarrow{r},E \right)\ \frac{1}{2\pi}\ f\left( \widehat{\Omega} \bullet {\widehat{n}}_{0} \right) \right\rbrack\ ,\end{aligned}\end{align} \]</div>
<p>where the constant <span class="math notranslate nohighlight">\(\text{Rc}\)</span> is used to make <span class="math notranslate nohighlight">\(\widehat{q}\)</span>
a pdf. Note that if either the original source directional distribution
<span class="math notranslate nohighlight">\(q\left( \widehat{\Omega} \right)\)</span> or the adjoint angular flux
distribution at the source is isotropic, then
<span class="math notranslate nohighlight">\(c = \frac{1}{4\pi}\)</span>.</p>
<p>For the general case of multiple sources, the biased source sampling
distribution, the biased source distributions and the weight windows are</p>
<div class="math notranslate nohighlight">
\[R_{i} = \iint_{}^{}{q_{i}\left( \overrightarrow{r},E\right)\ \phi^{+}\left( \overrightarrow{r},E \right)}\text{dE}\ \text{dr}\]</div>
<div class="math notranslate nohighlight">
\[c_{i} = \int_{}^{}{\frac{1}{2\pi}q_{i}\left( \widehat{\Omega} \bullet {\widehat{d}}_{i} \right)\ \frac{1}{2\pi}f\left( \widehat{\Omega} \bullet {\widehat{n}}_{i} \right)}d\widehat{\Omega}\]</div>
<div class="math notranslate nohighlight">
\[\widehat{p}\left( i \right) = \frac{{S_{i}R}_{i}c_{i}}{\sum_{}^{}{{S_{i}R}_{i}c_{i}}}\]</div>
<div class="math notranslate nohighlight">
\[{\widehat{q}}_{i}\left( \overrightarrow{r},E,\widehat{\Omega} \right) = \left\lbrack \frac{1}{R_{i}}\ q_{i}\left( \overrightarrow{r},E \right)\ \phi^{+}\left( \overrightarrow{r},E \right) \right\rbrack\ \left\lbrack \frac{1}{c_{i}}\ q_{i}\left( \widehat{\Omega} \right)\ f\left( \widehat{\Omega} \right) \right\rbrack = {\widehat{q}}_{i}\left( \overrightarrow{r},E \right)\ \frac{1}{c_{i}}\ \frac{1}{2\pi}q_{i}\left( \widehat{\Omega} \bullet {\widehat{d}}_{i} \right)\ \frac{1}{2\pi}f\left( \widehat{\Omega} \bullet {\widehat{n}}_{i} \right)\]</div>
<div class="math notranslate nohighlight">
\[\overline{w}\left( \overrightarrow{r},E,\widehat{\Omega} \right) = \frac{\sum_{}^{}{{S_{i}R}_{i}c_{i}}}{S\phi^{+}\left( \overrightarrow{r},E \right)} \ \ \frac{2\pi}{\ f\left( \widehat{\Omega} \bullet \widehat{n} \right)} = \frac{\sum_{}^{}{{S_{i}R}_{i}c_{i}}}{\sum_{}^{}{S_{i}R}_{i}} \ \ \overline{w}\left( \overrightarrow{r},E \right)\ \frac{2\pi}{f\left( \widehat{\Omega} \bullet \widehat{n} \right)} \ .\]</div>
<p>More details on the development of these methods and their application
for several problems have been presented <a class="bibtex reference internal" href="#peplow-hybrid-2010" id="id2">[PMEW10]</a><a class="bibtex reference internal" href="#peplow-consistent-2012" id="id3">[PME12]</a>.</p>
</div>
<div class="section" id="using-space-energy-angle-cadis-in-mavric">
<h3>Using space/energy/angle CADIS in MAVRIC<a class="headerlink" href="#using-space-energy-angle-cadis-in-mavric" title="Permalink to this headline">¶</a></h3>
<p>The two angular CADIS methods that use the AVATAR-type approximation of
adjoint flux are specified in MAVRIC with the “angularBiasing=” keyword
in the importanceMap block. Values for this keyword are 1 or 2.</p>
<p>Space/Energy/Angle CADIS without directional biasing (for beam sources)
– This method uses one specific location,
<span class="math notranslate nohighlight">\({\overrightarrow{r}}_{0}\)</span>, energy, <span class="math notranslate nohighlight">\(E_{0}\)</span>, and direction,
<span class="math notranslate nohighlight">\({\widehat{\Omega}}_{0},\)</span> which is the reference direction of the
source <span class="math notranslate nohighlight">\(\widehat{d}\)</span>, where the weight of the biased source
matches the weight window.</p>
<p>Space/Energy/Angle CADIS with directional biasing (for general sources)
– This method uses one specific energy, <span class="math notranslate nohighlight">\(E_{0}\)</span>, to determine the
adjoint current vector <span class="math notranslate nohighlight">\({\widehat{n}}_{0}\)</span> and the
<span class="math notranslate nohighlight">\(\lambda_{0}\)</span> parameter for the biased angular distribution for
each source.</p>
<p>With each method, the user must specify at what energy the importance
map and the biased sources should be made consistent. The particle type
must also be specified. This is done with the keywords “angBiasParType=”
(1 for neutron or 2 for photon) and “angBiasEnergy=” (with a value in
eV), also in the importanceMap block.</p>
<p>Note that all sources should have a direction <span class="math notranslate nohighlight">\(\widehat{d}\)</span> set,
using “direction <em>u v w</em>” within each source, even if the angular
distribution for a given source is isotropic. The direction is used for
source biasing and for aligning the weight windows and biased sources.
Also note that for either angular biasing method, the Denovo S<sub>N</sub>
calculation must use a Legendre order greater than 0.</p>
<p>With angular biasing, a mesh angular information (*.mai) file is
produced which can be visualized with the MeshFileViewer. This file
contains the space/energy-dependent
<span class="math notranslate nohighlight">\(\lambda\left( \overrightarrow{r},E \right)\)</span> values and components
of the average adjoint current direction
<span class="math notranslate nohighlight">\(\widehat{n}\left( \overrightarrow{r},E \right) = \left\langle n_{x},n_{y},n_{z} \right\rangle\)</span>.
An existing mesh angular information (*.mai) file can be used in a
separate MAVRIC problem by using the “meshAngInfoFile=” keyword in the
biasing block.</p>
</div>
<div class="section" id="example-problem">
<h3>Example problem<a class="headerlink" href="#example-problem" title="Permalink to this headline">¶</a></h3>
<p>Consider the Ueki shielding problem used as sample problems in the
Monaco and MAVRIC manuals. The goal is to calculate the neutron dose on
one side of a shield from a partially collimated <sup>252</sup>Cf source
on the other side of the shield. Both of the angular approaches
discussed above can be compared to analog and standard space/energy
CADIS calculations. For the analog calculations, no importanceMap block
is used. For the other cases, the importance map blocks are shown below.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">CADIS</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">Angular</span> <span class="err">CADIS</span> <span class="m">1</span> <span class="err">-</span>
<span class="err">without</span> <span class="err">a</span> <span class="err">biased</span> <span class="err">source</span>
<span class="err">angular</span> <span class="err">dist.</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">Angular</span> <span class="err">CADIS</span> <span class="m">2</span> <span class="err">-</span>
<span class="err">with</span> <span class="err">a</span> <span class="err">biased</span> <span class="err">source</span>
<span class="err">angular</span> <span class="err">dist.</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">macromaterial</span>
      <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">01</span>
    <span class="n">end</span><span class="err"> </span><span class="n">macromaterial</span>



<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">macromaterial</span>
      <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">01</span>
    <span class="n">end</span><span class="err"> </span><span class="n">macromaterial</span>

    <span class="err">angularbiasing=</span><span class="m">1</span>
    <span class="err">angBiasParType=</span><span class="m">1</span>
    <span class="err">angBiasEnergy</span><span class="m">=2.0e6</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">macromaterial</span>
      <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">01</span>
    <span class="n">end</span><span class="err"> </span><span class="n">macromaterial</span>

    <span class="err">angularbiasing=</span><span class="m">2</span>
    <span class="err">angBiasParType=</span><span class="m">1</span>
    <span class="err">angBiasEnergy</span><span class="m">=2.0e6</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Note that the energy at which to tie the importance map to the biased
source, 2 MeV, is about the average energy of the source energy
distribution. The figure-of-merit (FOM) of the calculation could change
as this parameter is varied.</p>
<p>Results, shown in <a class="reference internal" href="#tab4c1"><span class="std std-numref">Table 26</span></a>, demonstrate that the two directional
approaches improved the FOM for this problem by more than a factor of 2.
A larger boost is seen in method 2 where biasing is applied to the
source directional distribution. In this case, the biased source
distribution was an exponential distribution with a power of 2.45,
significantly sampling more source neutrons in the direction of the
shield than into the paraffin collimator block.</p>
<p>Note that the space/energy/angle CADIS methods require more memory to
hold the importance information. Improvements to the CADIS calculation
can also be made with a judicious choice of standard source direction
biasing, without an increase in memory requirements. A simple
distribution (where <span class="math notranslate nohighlight">\(\mu = 0.924\)</span> represents the edge of the cone
cutout and <span class="math notranslate nohighlight">\(\mu = 0.974\)</span> is the center half of the shield
dimension) added that to the source</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">distribution</span> <span class="m">2</span>
    <span class="err">abscissa</span> <span class="err">-</span><span class="m">1</span><span class="err">.</span><span class="m">0</span>     <span class="m">0</span><span class="err">.</span><span class="m">924</span>    <span class="err">.</span><span class="m">974</span>   <span class="m">1</span><span class="err">.</span><span class="m">0</span> <span class="n">end</span>
    <span class="err">truepdf</span>      <span class="m">0</span><span class="err">.</span><span class="m">962</span>     <span class="m">0</span><span class="err">.</span><span class="m">025</span>   <span class="err">.</span><span class="m">013</span>   <span class="n">end</span>
    <span class="err">biasedpdf</span>    <span class="m">0</span><span class="err">.</span><span class="m">500</span>     <span class="m">0</span><span class="err">.</span><span class="m">250</span>  <span class="m">0</span><span class="err">.</span><span class="m">250</span>   <span class="n">end</span>
<span class="n">end</span><span class="err"> </span><span class="n">distribution</span>

<span class="err">src</span> <span class="m">1</span>
    <span class="err">neutrons</span>  <span class="err">strength</span><span class="m">=4.05E+07</span>
    <span class="err">cuboid</span>  <span class="m">0</span><span class="err">.</span><span class="m">01</span> <span class="m">0</span><span class="err">.</span><span class="m">01</span>  <span class="m">0</span> <span class="m">0</span>  <span class="m">0</span> <span class="m">0</span>
    <span class="err">eDistributionID=</span><span class="m">1</span>
    <span class="err">direction</span> <span class="m">1</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span>
    <span class="err">dDistributionID=</span><span class="m">2</span>
<span class="n">end</span><span class="err"> </span><span class="n">src</span>
</pre></div>
</div>
<p>results in an FOM improvement of nearly 3 over the standard CADIS without the overhead of the angular CADIS methods.</p>
<table class="docutils align-center" id="tab4c1">
<caption><span class="caption-number">Table 26 </span><span class="caption-text">Results of the Ueki Shielding Problem (35 cm graphite shield)</span><a class="headerlink" href="#tab4c1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Calculation Method</p></td>
<td><p>Adj. S<sub>N</sub> (min)</p></td>
<td><p>MC (min)</p></td>
<td><p>dose rate (rem/hr)</p></td>
<td><p>relative
uncert</p></td>
<td><p>MC FOM
(/min)</p></td>
</tr>
<tr class="row-even"><td><p>Analog</p></td>
<td><p>0.0</p></td>
<td><p>152.7</p></td>
<td><p>3.998E-03</p></td>
<td><p>0.0101</p></td>
<td><p>64.7</p></td>
</tr>
<tr class="row-odd"><td><p>CADIS</p></td>
<td><p>0.2</p></td>
<td><p>9.9</p></td>
<td><p>3.998E-03</p></td>
<td><p>0.0081</p></td>
<td><p>1550</p></td>
</tr>
<tr class="row-even"><td><p>Directional CADIS 1,
no src bias</p></td>
<td><p>0.2</p></td>
<td><p>10.3</p></td>
<td><p>4.035E-03</p></td>
<td><p>0.0054</p></td>
<td><p>3390</p></td>
</tr>
<tr class="row-odd"><td><p>Directional CADIS 2,
with src bias</p></td>
<td><p>0.2</p></td>
<td><p>10.0</p></td>
<td><p>4.012E-03</p></td>
<td><p>0.0049</p></td>
<td><p>4190</p></td>
</tr>
<tr class="row-even"><td><p>CADIS, standard src
dir. bias</p></td>
<td><p>0.2</p></td>
<td><p>10.0</p></td>
<td><p>3.998E-03</p></td>
<td><p>0.0047</p></td>
<td><p>4550</p></td>
</tr>
</tbody>
</table>
<p>A series of problems was used to compare the space/energy/angle CADIS to
the standard space/energy CADIS. Most of the problems saw an improvement
of a factor of about 2 or 3. Some problems did not improve at all, and
some photon problems actually performed worse. In that case (a photon
litho-density gauge), it could be that the angular approximation for
importance, an exponential function in <span class="math notranslate nohighlight">\(\mu\)</span>, cannot adequately
describe the true importance.</p>
<p>Since the space/energy/angle CADIS methods are more difficult to explain
(more theory, adjustable parameters set by the user), require more
memory than standard CADIS, and may not offer any improvement over
standard space/energy CADIS, they have not been made part of the main
MAVRIC manual and have been left as an advanced/developing feature.
These methods were not removed from the MAVRIC code since they may be
helpful to future problems.</p>
</div>
</div>
<div class="section" id="university-of-michigan-methods-for-global-variance-reduction">
<h2>University of Michigan methods for global variance reduction<a class="headerlink" href="#university-of-michigan-methods-for-global-variance-reduction" title="Permalink to this headline">¶</a></h2>
<p>The use of hybrid deterministic/Monte Carlo methods, particularly for
global variance reduction, has been an active area of research by the
transport team at the University of Michigan for a long time. One of the
first approaches studied was a way to develop Monte Carlo weight window
target values that were proportional to deterministically estimated
values of the forward flux <a class="bibtex reference internal" href="#cooper-automated-2001" id="id4">[CL01]</a>. For global problems using isotropic
weight windows, this reference argues that in order to get uniform
relative uncertainties in the Monte Carlo calculation, the weight
windows should be set such that the number density of Monte Carlo
particles, <span class="math notranslate nohighlight">\(m\left( \overrightarrow{r} \right)\)</span>, is constant. The
physical particle density, <span class="math notranslate nohighlight">\(n\left( \overrightarrow{r} \right)\)</span>,
is related by the average weight,
<span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r} \right)\)</span>, to the Monte
Carlo particle density by</p>
<div class="math notranslate nohighlight">
\[n\left( \overrightarrow{r} \right) = \overline{w}\left( \overrightarrow{r} \right)\ m\left( \overrightarrow{r} \right) \ .\]</div>
<p>To make <span class="math notranslate nohighlight">\(m\left( \overrightarrow{r} \right)\)</span> constant over the
geometry, the weight window targets
<span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r} \right)\)</span> need to be
proportional to the physical particle density. Cooper and Larsen
calculate the weight window targets from an estimate of the forward
scalar flux <span class="math notranslate nohighlight">\(\phi\left( \overrightarrow{r} \right)\)</span> to be</p>
<div class="math notranslate nohighlight">
\[\overline{w}\left( \overrightarrow{r} \right) = \frac{\phi\left( \overrightarrow{r} \right)}{\mathrm{\max}\left( \phi\left( \overrightarrow{r} \right) \right)} \ .\]</div>
<p>Two approaches have since been developed <a class="bibtex reference internal" href="#becker-application-2009" id="id5">[BL09]</a>, based on what global
information the user desires from the simulation: global flux weight
windows, for obtaining every energy group at every location, and global
response weight windows, for obtaining an energy-integrated response at
every spatial location. Both of these methods are designed for
calculating the “global solution” – everywhere in the geometry of the
problem – with nearly uniform statistics.</p>
<p>Note that none of the University of Michigan methods discussed here
included the development of biased sources. These methods have all been
extended to include a consistent biased source by ORNL during their
implementation in the MAVRIC sequence of SCALE. The methods have also
been extended by ORNL for multiple sources.</p>
<div class="section" id="weight-windows-using-only-forward-estimates-of-flux">
<h3>Weight windows using only forward estimates of flux<a class="headerlink" href="#weight-windows-using-only-forward-estimates-of-flux" title="Permalink to this headline">¶</a></h3>
<div class="section" id="global-flux-weight-windows">
<h4>Global flux weight windows<a class="headerlink" href="#global-flux-weight-windows" title="Permalink to this headline">¶</a></h4>
<p>This method keeps the Monte Carlo particle distribution uniform in space
and energy. Note that this is a space/energy version of the original
space-only Cooper’s Method. The target weight windows,
<span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r},E \right)\)</span>, should be
proportional to the estimate of the forward scalar flux,
<span class="math notranslate nohighlight">\(\phi\left( \overrightarrow{r},E \right)\)</span>.</p>
<div class="math notranslate nohighlight">
\[\overline{w}\left( \overrightarrow{r},E \right) = c\ \phi\left( \overrightarrow{r},E \right) \ .\]</div>
<p>A biased source distribution,
<span class="math notranslate nohighlight">\(\widehat{q}\left( \overrightarrow{r},E \right)\)</span>, that is
consistent with the target weight windows can be found from the true
source distribution, <span class="math notranslate nohighlight">\(q\left( \overrightarrow{r},E \right)\)</span>, and
the forward flux to be</p>
<div class="math notranslate nohighlight">
\[\widehat{q}\left( \overrightarrow{r},E \right) = \ \frac{1}{c}\ \frac{q\left( \overrightarrow{r},E \right)}{\phi\left( \overrightarrow{r},E \right)}\ ,\]</div>
<p>where the constant <em>c</em> can be determined so that the biased source
distribution is a probability distribution function,</p>
<div class="math notranslate nohighlight">
\[c = \int_{V}^{}{\int_{E}^{}{\ \frac{q\left( \overrightarrow{r},E \right)}{\phi\left( \overrightarrow{r},E \right)}\ \text{dE}\ d\overrightarrow{r}}} \ .\]</div>
<p>Thus, using the estimate of forward flux, we can first compute <em>c</em> and
then form a consistent set of weight window target values and a biased
source distribution.</p>
</div>
<div class="section" id="global-response-weight-windows">
<h4>Global response weight windows<a class="headerlink" href="#global-response-weight-windows" title="Permalink to this headline">¶</a></h4>
<p>For an energy-integrated response (such as dose) desired at all spatial
locations, this method keeps the Monte Carlo particle distribution
proportional to the integral of the product of the response function,
<span class="math notranslate nohighlight">\(\sigma_{d}\left( \overrightarrow{r},E \right)\)</span>, and the estimate
of the forward flux, <span class="math notranslate nohighlight">\(\phi\left( \overrightarrow{r},E \right)\)</span>.
The energy-integrated response,
<span class="math notranslate nohighlight">\(D\left( \overrightarrow{r} \right)\)</span>, is found from the estimate
of the forward flux as</p>
<div class="math notranslate nohighlight">
\[D\left( \overrightarrow{r} \right) = \int_{E}^{}{\sigma_{d}\left( \overrightarrow{r},E \right)\ \phi\left( \overrightarrow{r},E \right) DE } .\]</div>
<p>The target weight windows,
<span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r},E \right)\)</span>, should be</p>
<div class="math notranslate nohighlight">
\[\overline{w}\left( \overrightarrow{r},E \right) = c\ \frac{D\left( \overrightarrow{r} \right)}{\sigma_{d}\left( \overrightarrow{r},E \right)} \ .\]</div>
<p>A biased source distribution,
<span class="math notranslate nohighlight">\(\widehat{q}\left( \overrightarrow{r},E \right)\)</span>, that is
consistent with the target weight windows can be found from the true
source distribution, <span class="math notranslate nohighlight">\(q\left( \overrightarrow{r},E \right)\)</span>, and
the forward dose estimate to be</p>
<div class="math notranslate nohighlight">
\[\widehat{q}\left( \overrightarrow{r},E \right) = \ \frac{1}{c}\ \frac{q\left( \overrightarrow{r},E \right)\ \sigma_{d}\left( \overrightarrow{r},E \right)}{D\left( \overrightarrow{r} \right)}\]</div>
<p>using a proportionality constant of</p>
<div class="math notranslate nohighlight">
\[c = \int_{V}^{}{\frac{1}{D\left( \overrightarrow{r} \right)}\int_{E}^{}{q\left( \overrightarrow{r},E \right)\ \sigma_{d}\left( \overrightarrow{r},E \right)\ \text{dE}\ d\overrightarrow{r}}}\text{\ .}\]</div>
</div>
<div class="section" id="implementation-in-mavric">
<h4>Implementation in MAVRIC<a class="headerlink" href="#implementation-in-mavric" title="Permalink to this headline">¶</a></h4>
<p>The global flux weight windows (GFWW) approach and the global response
weight windows (GRWW) are both triggered by specifying an importance map
block without any adjoint sources. For the GRWW approach, the response
of interest is listed in the importance map block. If none is listed,
GFWW is used.</p>
<p>For problems with multiple sources (each with probability distribution
function <span class="math notranslate nohighlight">\(q_{i}\left( \overrightarrow{r},E \right)\)</span> and strength
<span class="math notranslate nohighlight">\(S_{i}\)</span>, giving a total source strength of
<span class="math notranslate nohighlight">\(S = \sum_{}^{}S_{i}\)</span>), the GWW methods require a biased mesh
source for each. This was implemented in MAVRIC in a manner similar to
the multiple source CADIS routines. Each biased source,
<span class="math notranslate nohighlight">\({\widehat{q}}_{i}\left( \overrightarrow{r},E \right)\)</span>, is
developed as</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\widehat{q}_{i}\left( \vec{r},E \right) =
\begin{cases}\\\begin{split}   \frac{1}{c_{i}} \frac{q_{i}\left( \vec{r},E \right)}{\phi\left( \vec{r},E \right)}   \ \ \ \ \ &amp; \text{global flux weight windows} \\
   \frac{1}{c_{i}} \frac{q_{i}\left( \vec{r},E \right) \sigma_{d} \left( \vec{r},E \right)}{D \left( \vec{r}\right)} \ \ \ &amp; \text{global response weight windows}\end{split}\\\end{cases}\end{aligned}\end{align} \]</div>
<p>where <span class="math notranslate nohighlight">\(c_{i}\)</span> is a normalization constant. The weight windows are
then set to</p>
<div class="math notranslate nohighlight">
\[\begin{split}\overline{w}\left( \overrightarrow{r},E \right) = \left\{ \begin{matrix}
\frac{\sum_{}^{}c_{i}}{\sum_{}^{}S_{i}}\ \phi\left( \overrightarrow{r},E \right) &amp; \text{global flux weight windows} \\
\frac{\sum_{}^{}c_{i}}{\sum_{}^{}S_{i}}\ \frac{D\left( \overrightarrow{r} \right)}{\sigma_{d}\left( \overrightarrow{r},E \right)} &amp; \text{global response weight windows} \\
\end{matrix} \right.\ \ \ \ .\end{split}\]</div>
<p>In the final Monte Carlo, the specific source <em>i</em> is sampled with
probability <span class="math notranslate nohighlight">\(p\left( i \right) = \ S_{i}/S\)</span>, and then the particle
is sampled from the biased mesh source
<span class="math notranslate nohighlight">\({\widehat{q}}_{i}\left( \overrightarrow{r},E \right)\)</span>. Unlike the
CADIS method for multiple sources, there is no way to develop a biased
probability distribution for which source to sample without knowing the
contribution to the global estimate from each source separately.</p>
<p>For multiple source problems where the expected contribution from each
source is very different from the true strengths of those sources, it
may be more efficient to run a series of problems with one source each
for different amounts of time. The resulting mesh tallies can then be
added together using the mesh tally adder (part of the MAVRIC
utilities).</p>
</div>
</div>
<div class="section" id="methods-using-forward-and-adjoint-estimates">
<h3>Methods using forward and adjoint estimates<a class="headerlink" href="#methods-using-forward-and-adjoint-estimates" title="Permalink to this headline">¶</a></h3>
<p>Becker <a class="bibtex reference internal" href="#becker-hybrid-2009" id="id6">[Bec09]</a> proposed three methods for developing weight windows based
on both forward and adjoint deterministic solutions. These three methods
correspond to the portion of the phase space over which uniform relative
uncertainties are desired: a small “detector” region, a region
comprising a significant portion of the entire problem, and the global
problem. In this discussion, only a brief outline of each method,
focusing on its implementation into MAVRIC, will be given.</p>
<div class="section" id="source-detector-problems">
<h4>Source/detector problems<a class="headerlink" href="#source-detector-problems" title="Permalink to this headline">¶</a></h4>
<p>For a small detector of volume <span class="math notranslate nohighlight">\(V_{D}\)</span>where we want to optimize
the MC calculation of the detector response</p>
<div class="math notranslate nohighlight">
\[R = \int_{V_{D}}^{}{\int_{0}^{\infty}{\sigma\left( \overrightarrow{r},E \right)\ \phi\left( \overrightarrow{r},E \right)}\text{dE}\ \text{dV}}\]</div>
<p>or optimize for the energy dependent flux at the detector, the following
is used:</p>
<blockquote>
<div><dl>
<dt>forward flux estimate</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c5">
<span class="eqno">(29)<a class="headerlink" href="#equation-eq4c5" title="Permalink to this equation">¶</a></span>\[\phi\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>adjoint source for flux</dt><dd><div class="math notranslate nohighlight">
\[q^{+}\left( \overrightarrow{r},E \right) = \frac{1}{\phi\left( \overrightarrow{r},E \right)}\]</div>
</dd>
<dt>or for response</dt><dd><div class="math notranslate nohighlight">
\[q^{+}\left( \overrightarrow{r},E \right) = \sigma\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>adjoint flux</dt><dd><div class="math notranslate nohighlight">
\[\phi^{+}\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>contributon flux</dt><dd><div class="math notranslate nohighlight">
\[\phi^{c}\left( \overrightarrow{r},E \right) = \phi\left( \overrightarrow{r},E \right)\ \phi^{+}\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>normalization constant</dt><dd><div class="math notranslate nohighlight">
\[C_{\mathrm{\text{norm}}} = \frac{V_{D}}{\int_{V_{D}}^{}{\int_{0}^{\infty}{\phi^{c}\left( \overrightarrow{r},E \right)} dE} \ dV}\]</div>
</dd>
<dt>space-only contributon flux</dt><dd><div class="math notranslate nohighlight">
\[{\widetilde{\phi}}^{c}\left( \overrightarrow{r} \right) = \ C_{\mathrm{\text{norm}}}\int_{0}^{\infty}{\phi^{c}\left( \overrightarrow{r},E \right)} dE\]</div>
</dd>
<dt>spatial parameter</dt><dd><div class="math notranslate nohighlight">
\[\alpha\left( \overrightarrow{r} \right) = \left\lbrack 1 + exp\left( \frac{{\widetilde{\phi}}_{\mathrm{\max} \in V_{D}}^{c}}{{\widetilde{\phi}}^{c}\left( \overrightarrow{r} \right)} - \frac{{\widetilde{\phi}}^{c}\left( \overrightarrow{r} \right)}{{\widetilde{\phi}}_{\mathrm{\max} \in V_{D}}^{c}} \right) \right\rbrack^{- 1}\]</div>
</dd>
<dt>spatial parameter</dt><dd><div class="math notranslate nohighlight">
\[B\left( \overrightarrow{r} \right) = \ \alpha\left( \overrightarrow{r} \right){\widetilde{\phi}}^{c}\left( \overrightarrow{r} \right) + \ 1 - \ \alpha\left( \overrightarrow{r} \right)\]</div>
</dd>
<dt>weight windows</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c6">
<span class="eqno">(30)<a class="headerlink" href="#equation-eq4c6" title="Permalink to this equation">¶</a></span>\[\overline{w}\left( \overrightarrow{r},E \right) = \frac{B\left( \overrightarrow{r} \right)}{\phi^{+}\left( \overrightarrow{r},E \right)}\]</div>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="source-region-problems">
<h4>Source-region problems<a class="headerlink" href="#source-region-problems" title="Permalink to this headline">¶</a></h4>
<p>For a detector of volume <span class="math notranslate nohighlight">\(V_{D}\)</span> and surface area <span class="math notranslate nohighlight">\(A_{D}\)</span>
(smaller than the entire problem) where we want to optimize the MC
calculation of the detector response</p>
<div class="math notranslate nohighlight">
\[R\left( \overrightarrow{r} \right) = \int_{0}^{\infty}{\sigma\left( \overrightarrow{r},E \right)\ \phi\left( \overrightarrow{r},E \right)} dE \ \ \ \ \ \ \ \ \ \overrightarrow{r} \in V_{D}\]</div>
<p>or optimize for the energy dependent flux in the region, the following
is used:</p>
<blockquote>
<div><dl>
<dt>forward flux estimate</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c7">
<span class="eqno">(31)<a class="headerlink" href="#equation-eq4c7" title="Permalink to this equation">¶</a></span>\[\phi\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>adjoint source for flux</dt><dd><div class="math notranslate nohighlight">
\[q^{+}\left( \overrightarrow{r},E \right) = \frac{1}{\phi\left( \overrightarrow{r},E \right)}\]</div>
</dd>
<dt>adjoint source for response</dt><dd><div class="math notranslate nohighlight">
\[q^{+}\left( \overrightarrow{r},E \right) = \frac{\sigma\left( \overrightarrow{r},E \right)}{\int_{0}^{\infty}{\sigma\left( \overrightarrow{r},E \right)\ \phi\left( \overrightarrow{r},E \right)} dE}\]</div>
</dd>
<dt>adjoint flux estimate</dt><dd><div class="math notranslate nohighlight">
\[\phi^{+}\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>contributon flux</dt><dd><div class="math notranslate nohighlight">
\[\phi^{c}\left( \overrightarrow{r},E \right) = \phi\left( \overrightarrow{r},E \right)\ \phi^{+}\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>normalization constant</dt><dd><div class="math notranslate nohighlight">
\[C_{\mathrm{\text{norm}}} = \frac{A_{D}}{\int_{A_{D}}^{}{\int_{0}^{\infty}{\phi^{c}\left( \overrightarrow{r},E \right)} dE} \ dA}\]</div>
</dd>
<dt>space-only contributon flux</dt><dd><div class="math notranslate nohighlight">
\[{\widetilde{\phi}}^{c}\left( \overrightarrow{r} \right) = \ C_{\mathrm{\text{norm}}}\int_{0}^{\infty}{\phi^{c}\left( \overrightarrow{r},E \right)} dE\]</div>
</dd>
<dt>spatial parameter</dt><dd><div class="math notranslate nohighlight">
\[\alpha\left( \overrightarrow{r} \right) = \left\lbrack 1 + exp\left( \frac{{\widetilde{\phi}}_{\mathrm{\max} \in V_{D}}^{c}}{{\widetilde{\phi}}^{c}\left( \overrightarrow{r} \right)} - \frac{{\widetilde{\phi}}^{c}\left( \overrightarrow{r} \right)}{{\widetilde{\phi}}_{\mathrm{\max} \in V_{D}}^{c}} \right) \right\rbrack^{- 1}\]</div>
</dd>
<dt>spatial parameter</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c8">
<span class="eqno">(32)<a class="headerlink" href="#equation-eq4c8" title="Permalink to this equation">¶</a></span>\[ \begin{align}\begin{aligned} B\left( \vec{r} \right) =
 \begin{cases}\\    \tilde{\phi^{c}}\left(\vec{r}\right) &amp; \vec{r} \in V_{D}\\    \alpha\left(\vec{r}\right)\tilde{\phi^{c}}\left(\vec{r}\right) + 1 - \alpha\left(\vec{r}\right) &amp; \text{otherwise}\\ \end{cases}\end{aligned}\end{align} \]</div>
</dd>
<dt>weight windows</dt><dd><div class="math notranslate nohighlight">
\[\overline{w}\left( \overrightarrow{r},E \right) = \frac{B\left( \overrightarrow{r} \right)}{\phi^{+}\left( \overrightarrow{r},E \right)}\]</div>
</dd>
</dl>
</div></blockquote>
<p>Note that <span class="math notranslate nohighlight">\(A_{D}\)</span> does not include surfaces of <span class="math notranslate nohighlight">\(V_{D}\)</span> which
are on the boundary of the problem.</p>
</div>
<div class="section" id="global-response-problem">
<h4>Global response problem<a class="headerlink" href="#global-response-problem" title="Permalink to this headline">¶</a></h4>
<p>For optimizing the Monte Carlo calculation of a detector response
everywhere in phase space</p>
<div class="math notranslate nohighlight">
\[R(\overrightarrow{r}) = \int_{0}^{\infty}{\sigma\left( \overrightarrow{r},E \right)\ \phi\left( \overrightarrow{r},E \right)}\text{dE}\]</div>
<p>or optimizing for the energy-dependent flux everywhere, the following is
used:</p>
<blockquote>
<div><dl>
<dt>forward flux estimate</dt><dd><div class="math notranslate nohighlight" id="equation-eq4c9">
<span class="eqno">(33)<a class="headerlink" href="#equation-eq4c9" title="Permalink to this equation">¶</a></span>\[\phi\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>adjoint source for flux</dt><dd><div class="math notranslate nohighlight">
\[q^{+}\left( \overrightarrow{r},E \right) = \frac{1}{\phi\left( \overrightarrow{r},E \right)}\]</div>
</dd>
<dt>adjoint source for response</dt><dd><div class="math notranslate nohighlight">
\[q^{+}\left( \overrightarrow{r},E \right) = \frac{\sigma\left( \overrightarrow{r},E \right)}{\int_{0}^{\infty}{\sigma\left( \overrightarrow{r},E \right)\ \phi\left( \overrightarrow{r},E \right)} dE }\]</div>
</dd>
<dt>adjoint flux estimate</dt><dd><div class="math notranslate nohighlight">
\[\phi^{+}\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>contributon flux</dt><dd><div class="math notranslate nohighlight">
\[\phi^{c}\left( \overrightarrow{r},E \right) = \phi\left( \overrightarrow{r},E \right)\ \phi^{+}\left( \overrightarrow{r},E \right)\]</div>
</dd>
<dt>space-only contributon flux</dt><dd><div class="math notranslate nohighlight">
\[\phi^{c}\left( \overrightarrow{r} \right) = \int_{0}^{\infty}{\phi^{c}\left( \overrightarrow{r},E \right)} dE\]</div>
</dd>
<dt>spatial parameter</dt><dd><div class="math notranslate nohighlight">
\[B\left( \overrightarrow{r} \right) = \phi^{c}\left( \overrightarrow{r} \right)\]</div>
</dd>
<dt>weight windows</dt><dd><div class="math notranslate nohighlight">
\[\overline{w}\left( \overrightarrow{r},E \right) = \frac{B\left( \overrightarrow{r} \right)}{\phi^{+}\left( \overrightarrow{r},E \right)}\]</div>
</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="id7">
<h3>Implementation in MAVRIC<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Like CADIS and FW-CADIS, the Denovo S<sub>N</sub> code is used to
calculate the forward flux estimate,
<span class="math notranslate nohighlight">\(\phi\left( \overrightarrow{r},E \right)\)</span>, and the estimate of the
adjoint flux, <span class="math notranslate nohighlight">\(\phi^{+}\left( \overrightarrow{r},E \right)\)</span>, for
all of the Michigan weight window methods.</p>
<p>None of the above discussions of the University of Michigan methods
include information on how the weight window target values were adjusted
to match the source sampling. When implemented into MAVRIC, each of the
above problem types will compute a biased source,
<span class="math notranslate nohighlight">\(\widehat{q}\left( \overrightarrow{r},E \right)\)</span>, along with the
target weight, <span class="math notranslate nohighlight">\(\overline{w}\left( \overrightarrow{r},E \right)\)</span>,
that are produced. For a problem with a single source of strength
<span class="math notranslate nohighlight">\(S\)</span> and distribution <span class="math notranslate nohighlight">\(q\left( \overrightarrow{r},E \right)\)</span>,
the biased source
distribution<span class="math notranslate nohighlight">\(\ \widehat{q}\left( \overrightarrow{r},E \right)\)</span>
is found by using</p>
<div class="math notranslate nohighlight">
\[\widehat{q}\left( \overrightarrow{r},E \right) = \frac{q\left( \overrightarrow{r},E \right)}{\overline{w}\left( \overrightarrow{r},E \right)}\ .\]</div>
<p>The weight windows are multiplied by a factor of <span class="math notranslate nohighlight">\(R/S\)</span>, where
<span class="math notranslate nohighlight">\(R\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[R = \iint_{}^{}{\widehat{q}\left( \overrightarrow{r},E \right)}\phi^{+}\left( \overrightarrow{r},E \right)\ dE \ dV .\]</div>
<p>Sampled source particles will then be born with a weight that matches
the weight window of the phase space where they are born.</p>
<p>For multiple sources, each with strength <span class="math notranslate nohighlight">\(S_{i}\)</span> and distribution
<span class="math notranslate nohighlight">\(q_{i}\left( \overrightarrow{r},E \right)\)</span>, each biased source
distribution<span class="math notranslate nohighlight">\(\ {\widehat{q}}_{i}\left( \overrightarrow{r},E \right)\)</span>
is found by using</p>
<div class="math notranslate nohighlight">
\[{\widehat{q}}_{i}\left( \overrightarrow{r},E \right) = \frac{q_{i}\left( \overrightarrow{r},E \right)}{\overline{w}\left( \overrightarrow{r},E \right)}\]</div>
<p>and the response from each source being</p>
<div class="math notranslate nohighlight">
\[R_{i} = \iint_{}^{}{{\widehat{q}}_{i}\left( \overrightarrow{r},E \right)}dE \ dV \ .\]</div>
<p>The individual sources are sampled with a biased probability of
<span class="math notranslate nohighlight">\(\widehat{p}\left( i \right) = \ R_{i}/\sum_{}^{}R_{i}\)</span>. The
weight windows are then multiplied by a factor of</p>
<div class="math notranslate nohighlight">
\[\frac{\sum_{i}^{}R_{i}}{\sum_{i}^{}S_{i}}\]</div>
<p>to match the source birth weights.</p>
<p>To use one of the Becker methods in MAVRIC, the keyword “beckerMethod=”
is used with values of 1, 2, or 3 for the source/detector,
source/region, or global method. Adjoint sources are described just like
standard MAVRIC CADIS and FW-CADIS problems. To switch between
optimizing flux in every group or optimizing a response, the keywords
“fluxWeighting” and “respWeighting” are used. Just like FW‑CADIS, the
response listed in each adjoint source is the response that is
optimized. Note that even when starting a calculation with known forward
and adjoint flux files, the adjoint source(s) still need to be listed
since they are used in the final normalization of the weight windows.</p>
<div class="section" id="example-problems">
<h4>Example problems<a class="headerlink" href="#example-problems" title="Permalink to this headline">¶</a></h4>
<p>The first Becker method (source/detector) is demonstrated using the Ueki
shielding problem (used as sample problems in the Monaco and MAVRIC
manuals and above in the space/energy/angle CADIS example). The goal is
to calculate the neutron dose on one side of a shield from a partially
collimated <sup>252</sup>Cf source on the other side of the shield. For
the analog calculations, no importanceMap block is used. For the other
cases, the importance map blocks are shown below.</p>
<table class="docutils align-center" style="width: 80">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">CADIS</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">Becker</span> <span class="m">1</span> <span class="err">–</span> <span class="err">flux</span> <span class="err">optimization</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">Becker</span> <span class="m">2</span> <span class="err">–</span> <span class="err">response</span> <span class="err">optimization</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">macromaterial</span>
      <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">01</span>
    <span class="n">end</span><span class="err"> </span><span class="n">macromaterial</span>



<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">macromaterial</span>
      <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">01</span>
    <span class="n">end</span><span class="err"> </span><span class="n">macromaterial</span>

    <span class="err">beckerMethod=</span><span class="m">1</span>
    <span class="err">fluxWeighting</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">macromaterial</span>
      <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">01</span>
    <span class="n">end</span><span class="err"> </span><span class="n">macromaterial</span>

    <span class="err">beckerMethod=</span><span class="m">1</span>
    <span class="err">respWeighting</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The results are shown in <a class="reference internal" href="#tab4c2"><span class="std std-numref">Table 27</span></a>.
The Becker response-optimized source/detector method,
which requires two deterministic estimates, does slightly better
for this problem than standard CADIS, which only requires one deterministic estimate.</p>
<table class="docutils align-center" id="tab4c2">
<caption><span class="caption-number">Table 27 </span><span class="caption-text">Results of the Ueki Shielding Problem (35 cm graphite shield)</span><a class="headerlink" href="#tab4c2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Calculation method</p></td>
<td><p>For. S<sub>N</sub></p></td>
<td><p>Adj. S<sub>N</sub></p></td>
<td><p>MC</p></td>
<td><p>dose rate
(rem/hr)</p></td>
<td><p>relative
uncert</p></td>
<td><p>MC FOM
(/min)</p></td>
</tr>
<tr class="row-even"><td><p>Analog</p></td>
<td><p>0.0</p></td>
<td><p>0.0</p></td>
<td><p>152.7</p></td>
<td><p>3.998E-03</p></td>
<td><p>0.0101</p></td>
<td><p>6.47</p></td>
</tr>
<tr class="row-odd"><td><p>CADIS</p></td>
<td><p>0.0</p></td>
<td><p>0.2</p></td>
<td><p>9.9</p></td>
<td><p>3.988E-03</p></td>
<td><p>0.0081</p></td>
<td><p>1550</p></td>
</tr>
<tr class="row-even"><td><p>Becker, source/detector
flux</p></td>
<td><p>0.2</p></td>
<td><p>0.2</p></td>
<td><p>9.9</p></td>
<td><p>4.027E-03</p></td>
<td><p>0.099</p></td>
<td><p>1040</p></td>
</tr>
<tr class="row-odd"><td><p>Becker, source/detector
resp</p></td>
<td><p>0.2</p></td>
<td><p>0.2</p></td>
<td><p>10.1</p></td>
<td><p>4.025E-03</p></td>
<td><p>0.0075</p></td>
<td><p>1760</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="a-global-problem">
<h4>A global problem<a class="headerlink" href="#a-global-problem" title="Permalink to this headline">¶</a></h4>
<p>For an example of a global problem, consider a two-room block building
with a criticality accident in one room. The objective is to find the
photon dose everywhere in order to see the locations where criticality
alarms would trigger. The building is 12 meters long, 6 meters wide, and
3 meters tall. A comparison will be made between an analog calculation,
an FW-CADIS calculation (using response weighting), GRWW, Becker’s
source/region method (response optimization), and Becker’s global method
(response optimization). The MAVRIC importance map block of each
calculation is as follows.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">FW-CADIS</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">GRWW</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">Becker</span> <span class="err">source/region</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="err">Becker</span> <span class="err">-</span> <span class="err">global</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">gridGeometryID=</span><span class="m">1</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">boundingBox</span>
            <span class="m">1200</span> <span class="m">0</span>
            <span class="m">600</span> <span class="m">0</span>
            <span class="m">300</span> <span class="err">-</span><span class="m">60</span><span class="err">.</span><span class="m">0</span>
        <span class="err">responseID=</span><span class="m">6</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>

    <span class="err">respWeighting</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">gridGeometryID=</span><span class="m">1</span>
    <span class="err">responseID=</span><span class="m">6</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">gridGeometryID=</span><span class="m">1</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">boundingBox</span>
            <span class="m">1190</span> <span class="m">10</span>
            <span class="m">590</span> <span class="m">10</span>
            <span class="m">290</span> <span class="err">-</span><span class="m">560</span><span class="err">.</span><span class="m">0</span>
        <span class="err">responseID=</span><span class="m">6</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">beckerMethod=</span><span class="m">2</span>
    <span class="err">respWeighting</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">gridGeometryID=</span><span class="m">1</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">boundingBox</span>
            <span class="m">1200</span> <span class="m">0</span>
            <span class="m">600</span> <span class="m">0</span>
            <span class="m">300</span> <span class="err">-</span><span class="m">60</span><span class="err">.</span><span class="m">0</span>
        <span class="err">responseID=</span><span class="m">6</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">beckerMethod=</span><span class="m">3</span>
    <span class="err">respWeighting</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Note that Becker’s source/region method is designed for regions smaller
than the entire problem, so this is not a fair comparison, just a
demonstration on how to use it in MAVRIC. The bounding box of the
adjoint source in this case is set slightly smaller than the extent of
the entire problem.</p>
<p>Results for the photon dose and its relative uncertainty using the five
different methods of calculation are shown in <a class="reference internal" href="#fig4c3"><span class="std std-numref">Fig. 50</span></a>.
Information on the distribution of relative uncertainties is shown in
<a class="reference internal" href="#fig4c4"><span class="std std-numref">Fig. 51</span></a> and listed in <a class="reference internal" href="#tab4c3"><span class="std std-numref">Table 28</span></a>.</p>
<p>A more detailed comparison of the different hybrid methods for
representative shielding problems can be found in <a class="bibtex reference internal" href="#peplow-comparison-2013" id="id8">[Pep13]</a>.</p>
<div class="figure align-center" id="id15">
<span id="fig4c3"></span><img alt="_images/fig4c3.png" src="_images/fig4c3.png" />
<p class="caption"><span class="caption-number">Fig. 50 </span><span class="caption-text">Mesh tally results for the photon dose over the entire building use five different methods.</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id16">
<span id="fig4c4"></span><a class="reference internal image-reference" href="_images/fig4c4.png"><img alt="_images/fig4c4.png" src="_images/fig4c4.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-number">Fig. 51 </span><span class="caption-text">The fraction of mesh tally voxels with less than a given amount of relative uncertainty for the five different methods.</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-center" id="tab4c3">
<caption><span class="caption-number">Table 28 </span><span class="caption-text">Comparison of the five different methods</span><a class="headerlink" href="#tab4c3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Calculation method</p></td>
<td><p>Forward S<sub>N</sub>
(min)</p></td>
<td><p>Adjoint S<sub>N</sub>
(min)</p></td>
<td><p>Monte Carlo
(min)</p></td>
<td><p>fraction of voxels
with relative
uncertainties
less than 5%</p></td>
<td><p>fraction of voxels
with relative
uncertainties
less than 10%</p></td>
<td><p>fraction of voxels
with relative
uncertainties
less than 15%</p></td>
</tr>
<tr class="row-even"><td><p>Analog</p></td>
<td></td>
<td></td>
<td><p>20.1</p></td>
<td><p>0.583</p></td>
<td><p>0.857</p></td>
<td><p>0.973</p></td>
</tr>
<tr class="row-odd"><td><p>Analog, long</p></td>
<td></td>
<td></td>
<td><p>308.1</p></td>
<td><p>0.996</p></td>
<td><p>1.000</p></td>
<td><p>1.000</p></td>
</tr>
<tr class="row-even"><td><p>FW-CADIS,
response weighting</p></td>
<td><p>3.5</p></td>
<td><p>3.4</p></td>
<td><p>20.3</p></td>
<td><p>0.946</p></td>
<td><p>1.000</p></td>
<td><p>1.000</p></td>
</tr>
<tr class="row-odd"><td><p>GRWW</p></td>
<td><p>4.0</p></td>
<td></td>
<td><p>20.2</p></td>
<td><p>0.005</p></td>
<td><p>0.180</p></td>
<td><p>0.387</p></td>
</tr>
<tr class="row-even"><td><p>Becker,
source/region</p></td>
<td><p>4.0</p></td>
<td><p>3.6</p></td>
<td><p>19.0</p></td>
<td><p>0.016</p></td>
<td><p>0.350</p></td>
<td><p>0.800</p></td>
</tr>
<tr class="row-odd"><td><p>Becker,
global response</p></td>
<td><p>4.2</p></td>
<td><p>4.4</p></td>
<td><p>20.4</p></td>
<td><p>0.016</p></td>
<td><p>0.358</p></td>
<td><p>0.832</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="other-special-options-for-the-importance-map-block-input">
<h3>Other special options for the importance map block input<a class="headerlink" href="#other-special-options-for-the-importance-map-block-input" title="Permalink to this headline">¶</a></h3>
<p>In MAVRIC, the above methods have been extended to use biased sources.
To turn off the use of a biased source, use the keyword “selfNormalize”.
For forward flux–based methods, this will scale the target weights in
the importance map so that the largest value is 1, which typically is at
the source location. To use the forward-based Michigan methods (Cooper,
GFWW, GRWW) or the van Wijk <a class="bibtex reference internal" href="#van-wijk-easy-2011" id="id9">[VWVdEH11]</a> methods as they were presented (without
the MAVRIC biased source), use this keyword.</p>
<p>Use the keyword “spaceOnly=<span class="math notranslate nohighlight">\(n\)</span>” to create an importance map
that contains one energy group over the entire range of energy. Use a
value of 1 for neutron problems or a value of 2 for photon problems.
This option is not designed for coupled problems. Both of the methods
that van Wijk presents use importance maps that are space only.</p>
<p>Use the keyword “forwardParam=<span class="math notranslate nohighlight">\(p\)</span>” to allow the target weights
to be proportional to the forward estimate (using Denovo) of flux raised
to any power <span class="math notranslate nohighlight">\(p\)</span>.</p>
<div class="math notranslate nohighlight">
\[\overline{w}\left( \overrightarrow{r} \right) = \frac{\phi^{p}\left( \overrightarrow{r} \right)}{\mathrm{\max}\left( \phi^{p}\left( \overrightarrow{r} \right) \right)}\ .\]</div>
<p>For Cooper’s method or van Wijk’s first method, <span class="math notranslate nohighlight">\(p = 1\)</span>, which is
the default if “forwardParam” is not specified. For van Wijk’s second
method, based on the relative error estimate
<span class="math notranslate nohighlight">\(\text{Re}\left( \overrightarrow{r} \right) \propto \frac{1}{\sqrt{\phi\left( \overrightarrow{r} \right)}}\)</span>,
set this parameter to <span class="math notranslate nohighlight">\(p = 0.5\)</span>. Note that with a power less than
1, the weight window targets will span a smaller range than the expected
Monte Carlo flux values. Particles may be rouletted before they reach
the lowest flux areas of the problem.</p>
<p>When applying FW-CADIS for a semi-global problem, the adjoint source
should cover the area where the lowest uncertainties are desired.
Sometimes the area where this is desired is not a fixed geometric area
but instead an area that has a final answer of a certain range. For
example, when finding dose rate maps, the user may only be interested in
getting low uncertainties for areas below the dose limit – areas above
the dose limit may not matter as much since people will not be allowed
in those areas. Another example may be that the dose map should be
optimized in those areas above the background dose rate, since dose
rates below that are of no concern. To allow the adjoint source area to
be tailored in this way, the keywords “minForwardValue=” and/or
“maxForwardValue=”can be used. Default values are 0 and 10<sup>100</sup>,
respectively. For flux weighting, only the voxels within the adjoint
source bounding box and containing a forward flux estimate between the
min and max are included as adjoint sources.</p>
<p>A comparison <a class="bibtex reference internal" href="#peplow-comparison-2013" id="id10">[Pep13]</a> of FW-CADIS to the University of Michigan methods and
the Van Wijk methods showed that FW-CADIS performs better and is more
straightforward to use than the other methods. These other methods were
added to SCALE so that a fair comparison could be made and have been
left in the code base for academic use in case some types of problems
could benefit from them.</p>
</div>
</div>
<div class="section" id="using-mavric-to-run-fixed-source-denovo-calculations">
<h2>Using MAVRIC to run fixed-source Denovo calculations<a class="headerlink" href="#using-mavric-to-run-fixed-source-denovo-calculations" title="Permalink to this headline">¶</a></h2>
<p>The MAVRIC sequence of SCALE can be used to run the new
discrete-ordinates code Denovo <a class="bibtex reference internal" href="#evans-denovo-2010" id="id11">[ESSC10]</a> The sequence is designed to use
Denovo to compute an importance map for the Monte Carlo code Monaco but
can be stopped without starting the final Monaco calculation. The full
version of Denovo has a python-based user interface where the user must
construct the geometry, source, and cross sections on their own. MAVRIC
provides an easy interface to run the serial-only version of Denovo
within SCALE (called ‘xkba’). Denovo inputs made using MAVRIC can also
be imported into the python interface for the HPC version of Denovo.</p>
<p>To create Denovo inputs or run Denovo using MAVRIC, input the
composition, geometry (including arrays if needed), definitions (grid
geometry and response information), and sources block as if an actual
full MAVRIC case were being run. The sequence should then be started
with a <code class="docutils literal notranslate"><span class="pre">parm=xxx</span></code> flag to indicate to MAVRIC to stop after making Denovo
inputs or running Denovo.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>parm=</p></th>
<th class="head"><p>MAVRIC stops after</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>Forward Calculations</em></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>forinp</p></td>
<td><p>Making cross sections and Denovo input</p></td>
</tr>
<tr class="row-even"><td><p>forward</p></td>
<td><p>Running Denovo</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><em>Adjoint Calculations</em></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>adjinp</p></td>
<td><p>Making cross sections and Denovo input</p></td>
</tr>
<tr class="row-even"><td><p>adjoint</p></td>
<td><p>Running Denovo</p></td>
</tr>
</tbody>
</table>
<p>For forward Denovo simulations, the importance map block should contain
which grid geometry to use and any of the optional Denovo parameters:</p>
<p>For forward Denovo simulations, the importance map block should contain which grid geometry to use and any of the optional Denovo parameters:</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
<p>For adjoint Denovo calculations, the importance map block should contain which grid geometry to use, one or more adjoint sources, and any of the optional Denovo parameters:</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
<p>For either forward or adjoint, the following files will be produced and should be copied out of the SCALE temporary directory back to your home area:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ft02f001</p></th>
<th class="head"><p>the AMPX mixed working library cross section file</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xkba_b.inp</p></td>
<td><p>binary input file for Denovo</p></td>
</tr>
<tr class="row-odd"><td><p>*.dff</p></td>
<td><p>Denovo flux file (binary) - scalar fluxes</p></td>
</tr>
</tbody>
</table>
<p>The scalar flux file is automatically copied back to the home area when SCALE completes. The others can be copied back if desired using a shell command at the end of the MAVRIC input file (windows example shown below):</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="nf">=shell</span>
    <span class="err">copy</span> <span class="err">ft</span><span class="m">02</span><span class="err">f</span><span class="m">001</span>   <span class="err">%{RTNDIR}%/mixed.ft</span><span class="m">02</span><span class="err">f</span><span class="m">001</span>
    <span class="err">copy</span> <span class="err">xkba_b.inp</span> <span class="err">%{RTNDIR}%/denovo.dsi</span>
<span class="n">end</span>
</pre></div>
</div>
<p>The xkba_b.inp file and the *.dff file can both be viewed with the Java
utility, Mesh File Viewer, that is shipped with SCALE. The xkba_b.inp
file shows the Denovo source distribution (space and energy), and the
*.dff shows the final computed scalar fluxes. The binary Denovo input
file should be renamed with an extension of *.dsi (Denovo simple input)
so that the viewer can properly interpret the data.</p>
<div class="section" id="optional-denovo-parameters">
<h3>Optional Denovo parameters<a class="headerlink" href="#optional-denovo-parameters" title="Permalink to this headline">¶</a></h3>
<p>The default values for various calculational parameters and settings
used by Denovo for the MAVRIC sequence should cover most applications.
These settings can be changed by the interested user in the importance
map block. The two most basic parameters are the quadrature set used for
the discrete ordinates and the order of the Legendre polynomials used in
describing the angular scattering. The default quadrature order that
MAVRIC uses is S<sub>8</sub>, and for the order of Legendre polynomials,
the default is P<sub>3</sub> (or the maximum number of coefficients
contained in the cross section library, if less than 3).
S<sub>8</sub>/P <sub>3</sub> should be a good choice for many applications, but
the user is free to changes these. For complex ducts or transport over
large distance at small angles, S<sub>12</sub> may be required.
S<sub>4</sub>/P <sub>1</sub> would be useful in doing a very cursory run just
to check if the problem was input correctly. Other parameters that can
be set by the user in the importance map block for Denovo calculations
are listed in <a class="reference internal" href="#tab4c4"><span class="std std-numref">Table 29</span></a>.</p>
<table class="docutils align-center" id="tab4c4">
<caption><span class="caption-number">Table 29 </span><span class="caption-text">Optional Denovo parameters for the MAVRIC Importance Map Block</span><a class="headerlink" href="#tab4c4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/tab4c4.png" src="_images/tab4c4.png" />
</td>
</tr>
</tbody>
</table>
<p>In problems with small sources or media that are not highly scattering,
discrete ordinates can suffer from “ray effects”—where artifacts of the
quadrature directions can be seen in the computed fluxes. To help
alleviate the ray effects problem, Denovo has a first-collision
capability. This computes the amount of uncollided flux in each mesh
cell from a point source. These uncollided fluxes are then used as a
distributed source in the main discrete-ordinates solution. At the end
of the main calculation, the uncollided fluxes are added to the fluxes
computed with the first-collision source, forming the total flux. While
this helps reduce ray effects in many problems, the first-collision
capability can take a long time to compute on a mesh with many cells or
for many point sources.</p>
<p>The macromaterials option (“mmTolerance=”) can be used to better
represent the geometry in Denovo. Refer to the main MAVRIC manual for
details on macromaterials.</p>
</div>
<div class="section" id="forward-source-preparations">
<h3>Forward source preparations<a class="headerlink" href="#forward-source-preparations" title="Permalink to this headline">¶</a></h3>
<p>The user-entered source description is converted to a mesh-based source
for Denovo. To create the mesh source, MAVRIC determines if the defined
source exists within each cell. This is done by dividing each mesh cell
into <em>n</em>×<em>n</em>×<em>n</em> subcells (from the keyword “subCells=<em>n</em>”
in the importance map block with a default of <em>n</em>=2) and testing each
subcell center. For every subcell center that is a valid source position
(within the spatial solid and meets optional unit, region, or mixture
requirements), an amount of source proportional to the subcell volume is
assigned to the mesh cell. The keyword “subCells=” can be used to better
refine how much source is computed for the mesh cells at the boundary of
a curved source region. Of course, more subcell testing takes more time.</p>
<p>The above process may miss small sources or degenerate sources
(surfaces, lines, points) that do not lie on the tested subcell centers.
If none of the mesh cells contain any source after the subcell method,
then random sampling of the source is used. A number of source positions
are sampled from the source (set by the “sourceTrials=” keyword, default
of 1000000) and then placed into the proper mesh cell. If this method is
used, the resulting Denovo input file should be visualized to ensure
that the statistical nature of the source trials method does not unduly
influence the overall mesh source.</p>
<p>For forward calculations, if the number of mesh cells containing the
true source is less than 10, then MAVRIC will convert these source
voxels to point sources, to allow Denovo to use its first-collision
capability to help reduce ray effects. The user can easily override the
MAVRIC defaults—to force the calculation of a first-collision source no
matter how many voxels contain source—by using the keyword
“firstCollision.” To prevent the calculation of a first-collision
source, the keyword “noFirstCollision” can be used.</p>
<p>For coupled problems, there are two ways to make Denovo compute photon
fluxes from a neutron source: 1) include a tally using a photon response
or 2) manually specify the “startGroup=” and the “endGroup=” to cover
the particles/energy groups that are desired in the final Denovo output.</p>
</div>
<div class="section" id="adjoint-source-preparation">
<h3>Adjoint source preparation<a class="headerlink" href="#adjoint-source-preparation" title="Permalink to this headline">¶</a></h3>
<p>For adjoint calculations, adjoint sources that use point locations will
use the Denovo first-collision capability. Volumetric adjoint sources
(that use a boundingBox) will be treated without the first-collision
capability. The keywords “firstCollision” and “noFirstCollision” will be
ignored by MAVRIC for adjoint calculations.</p>
<p>Note that for an adjoint Denovo calculation, the MAVRIC input must still
list a forward source. Otherwise, the sequence will report an error and
stop. The forward source is not used for an adjoint Denovo calculation,
but it must be present to make a legal MAVRIC input. For a coupled
problem using an adjoint photon source, using a neutron forward source
will make Denovo compute both photon and neutron adjoint fluxes. If the
forward source(s) and adjoint source(s) are all photon, then only photon
adjoint fluxes will be computed. The keywords “startGroup=” and
“endGroup=” can also be used to manually set the particles/energy groups
that are desired in the final Denovo output.</p>
</div>
<div class="section" id="other-notes">
<h3>Other notes<a class="headerlink" href="#other-notes" title="Permalink to this headline">¶</a></h3>
<p>Denovo (in SCALE 6) is a fixed-source S<sub>N</sub> solver and cannot
model multiplying media. Neither forward nor adjoint neutron
calculations from Denovo will be accurate when neutron multiplication is
a major source component. If neutron multiplication is not turned off in
the parameters block of the MAVRIC input (using keyword “noFissions”), a
warning will be generated to remind the user of this limitation.</p>
<p>By default, MAVRIC instructs Denovo not to perform outer iterations for
neutron problems if the cross-section library contains upscatter groups.
This is because the time required to calculate the fluxes using
upscatter can be significantly longer than without. For problems where
thermal neutrons are an important part of the transport or tallies, the
user should specify the keyword “upScatter=1” in the importance map
block. This will instruct Denovo to perform the outer iterations for the
upscatter groups, giving more accurate results but taking a longer time.</p>
</div>
<div class="section" id="mavric-utilities-for-denovo">
<h3>MAVRIC utilities for Denovo<a class="headerlink" href="#mavric-utilities-for-denovo" title="Permalink to this headline">¶</a></h3>
<p>Denovo simply calculates scalar fluxes for every mesh cell and energy
group – it does not compute responses based on those fluxes. Several
utilities have been added to the collection of MAVRIC utilities in order
to allow the user to further process Denovo scalar flux results. The
full details and input descriptions for these utilities can be found in
the MAVRIC Utilities description in Appendix B.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>dff2dso</p></td>
<td><p>Convert a Denovo flux file into a
Denovo spatial output file.</p></td>
</tr>
<tr class="row-even"><td><p>dff2mai</p></td>
<td><p>Convert a Denovo flux file into a
mesh angular information file.</p></td>
</tr>
<tr class="row-odd"><td><p>dff2mim</p></td>
<td><p>Invert a Denovo flux file and
store as a mesh importance map.</p></td>
</tr>
<tr class="row-even"><td><p>dff2msl</p></td>
<td><p>Convert a Denovo flux file into a
mesh source lite.</p></td>
</tr>
<tr class="row-odd"><td><p>dffBinOp</p></td>
<td><p>Binary operation of Denovo flux
files: sum, difference, product,
and ratio.</p></td>
</tr>
<tr class="row-even"><td><p>dffDisp</p></td>
<td><p>Display the basics of a Denovo
flux file.</p></td>
</tr>
<tr class="row-odd"><td><p>dffFilter</p></td>
<td><p>Perform various filters on a
Denovo flux file.</p></td>
</tr>
<tr class="row-even"><td><p>dffFix</p></td>
<td><p>Fix the zero and negative values
in a Denovo flux file.</p></td>
</tr>
<tr class="row-odd"><td><p>dffInt</p></td>
<td><p>Integrate a single particle type
from a Denovo flux file.</p></td>
</tr>
<tr class="row-even"><td><p>dffInv</p></td>
<td><p>Invert the values in a Denovo
flux file.</p></td>
</tr>
<tr class="row-odd"><td><p>dffMult</p></td>
<td><p>Multiply a Denovo flux file by a
constant factor.</p></td>
</tr>
<tr class="row-even"><td><p>dffPull</p></td>
<td><p>Pull fluxes from certain voxels
out of a Denovo flux file.</p></td>
</tr>
<tr class="row-odd"><td><p>dffResp</p></td>
<td><p>Apply a response function to
scalar fluxes in a Denovo flux
file.</p></td>
</tr>
<tr class="row-even"><td><p>dffSplit</p></td>
<td><p>Split off a single particle type
from a Denovo flux file.</p></td>
</tr>
</tbody>
</table>
<p>There are also two utility programs that look at the Denovo simple input
file (binary) that MAVRIC creates. In the SCALE temporary directory, the
file is called xkba_b.inp. In order to display in the MeshFileViewer,
Denovo simple input files need to be renamed with a *.dsi extension.
The utilities are as follows.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>dsi2asc</p></td>
<td><p>Convert a Denovo simple input (*.dsi) from binary to ASCII</p>
<p>(so the user can see every detail).</p>
</td>
</tr>
<tr class="row-even"><td><p>dsiDisp</p></td>
<td><p>Display the basics of a Denovo simple input file.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id12">
<h3>Example problem<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="section" id="forward">
<h4>Forward<a class="headerlink" href="#forward" title="Permalink to this headline">¶</a></h4>
<p>As an example, consider a simulation based on the Ueki shielding
experiments (see Monaco manual). A <sup>252</sup>Cf neutron source was
placed in the center of a 50 cm cube of paraffin which had a 45° cone
cut-out. The goal is to calculate the neutron dose at a detector 110 cm
from the source.</p>
<p>The input file (<code class="docutils literal notranslate"><span class="pre">denovo1.inp</span></code>) needs the compositions of the paraffin and
graphite</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">composition</span>
    <span class="err">para(h</span><span class="m">2</span><span class="err">o)</span>    <span class="m">3</span>         <span class="m">1</span><span class="err">.</span><span class="m">0</span> <span class="m">293</span><span class="err">.</span><span class="m">0</span> <span class="n">end</span>
    <span class="err">carbon</span>       <span class="m">4</span> <span class="err">den=</span><span class="m">1</span><span class="err">.</span><span class="m">7</span> <span class="m">1</span><span class="err">.</span><span class="m">0</span> <span class="m">293</span><span class="err">.</span><span class="m">0</span> <span class="n">end</span>
<span class="n">end</span><span class="err"> </span><span class="n">composition</span>
</pre></div>
</div>
<p>then the geometry</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">geometry</span>
    <span class="err">global</span> <span class="err">unit</span> <span class="m">1</span>
        <span class="err">cuboid</span>  <span class="m">1</span>   <span class="m">25</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">25</span><span class="err">.</span><span class="m">0</span>  <span class="m">25</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">25</span><span class="err">.</span><span class="m">0</span>   <span class="m">25</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">25</span><span class="err">.</span><span class="m">0</span>
        <span class="err">cone</span>    <span class="m">2</span>  <span class="m">10</span><span class="err">.</span><span class="m">35948</span>  <span class="m">25</span><span class="err">.</span><span class="m">01</span>   <span class="m">0</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span>   <span class="err">rotate</span>  <span class="err">a</span><span class="m">1</span><span class="err">=-</span><span class="m">90</span> <span class="err">a</span><span class="m">2</span><span class="err">=-</span><span class="m">90</span> <span class="err">a</span><span class="m">3</span><span class="err">=</span><span class="m">0</span>
        <span class="err">cuboid</span>  <span class="m">3</span>   <span class="m">90</span><span class="err">.</span><span class="m">0</span>  <span class="m">70</span><span class="err">.</span><span class="m">0</span>  <span class="m">40</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">40</span><span class="err">.</span><span class="m">0</span>   <span class="m">40</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">40</span><span class="err">.</span><span class="m">0</span>
        <span class="err">cuboid</span> <span class="m">99</span>  <span class="m">120</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">30</span><span class="err">.</span><span class="m">0</span>  <span class="m">50</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">50</span><span class="err">.</span><span class="m">0</span>   <span class="m">50</span><span class="err">.</span><span class="m">0</span> <span class="err">-</span><span class="m">50</span><span class="err">.</span><span class="m">0</span>
        <span class="err">media</span> <span class="m">3</span> <span class="m">1</span>  <span class="m">1</span> <span class="err">-</span><span class="m">2</span>
        <span class="err">media</span> <span class="m">0</span> <span class="m">1</span>  <span class="m">2</span>
        <span class="err">media</span> <span class="m">4</span> <span class="m">1</span>  <span class="m">3</span>
        <span class="err">media</span> <span class="m">0</span> <span class="m">1</span>  <span class="m">99</span> <span class="err">-</span><span class="m">1</span>  <span class="err">-</span><span class="m">2</span> <span class="err">-</span><span class="m">3</span>
    <span class="err">boundary</span> <span class="m">99</span>
<span class="n">end</span><span class="err"> </span><span class="n">geometry</span>
</pre></div>
</div>
<p>then the position of the detector, the response of the detector and the mesh to use for Denovo</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">definitions</span>
    <span class="err">location</span> <span class="m">1</span>
        <span class="err">position</span> <span class="m">110</span> <span class="m">0</span> <span class="m">0</span>
    <span class="n">end</span><span class="err"> </span><span class="n">location</span>
    <span class="err">response</span> <span class="m">5</span>
        <span class="err">title=</span><span class="s">&quot;ANSI standard (1977) neutron flux-to-dose-rate factors&quot;</span>
        <span class="err">specialDose=</span><span class="m">9029</span>
    <span class="n">end</span><span class="err"> </span><span class="n">response</span>
    <span class="err">distribution</span> <span class="m">1</span>
        <span class="err">title=</span><span class="s">&quot;Cf-252 neutrons, Watt spectrum a=1.025 MeV and b=2.926/MeV&quot;</span>
        <span class="err">special=</span><span class="s">&quot;wattSpectrum&quot;</span>
        <span class="err">parameters</span> <span class="m">1</span><span class="err">.</span><span class="m">025</span> <span class="m">2</span><span class="err">.</span><span class="m">926</span> <span class="n">end</span>
    <span class="n">end</span><span class="err"> </span><span class="n">distribution</span>
    <span class="err">gridGeometry</span> <span class="m">7</span>
        <span class="err">xLinear</span> <span class="m">4</span> <span class="err">-</span><span class="m">25</span> <span class="err">-</span><span class="m">5</span>
        <span class="err">xLinear</span> <span class="m">15</span> <span class="err">-</span><span class="m">5</span> <span class="m">25</span>
        <span class="err">xLinear</span>  <span class="m">9</span> <span class="m">25</span> <span class="m">70</span>
        <span class="err">xLinear</span>  <span class="m">8</span> <span class="m">70</span> <span class="m">90</span>
        <span class="err">xplanes</span> <span class="err">-</span><span class="m">30</span> <span class="m">95</span> <span class="m">100</span> <span class="m">105</span> <span class="m">109</span> <span class="m">111</span> <span class="m">115</span> <span class="m">120</span>  <span class="n">end</span>

        <span class="err">yplanes</span> <span class="err">-</span><span class="m">50</span> <span class="err">-</span><span class="m">40</span> <span class="m">40</span> <span class="m">50</span> <span class="n">end</span>
        <span class="err">yLinear</span>  <span class="m">5</span> <span class="err">-</span><span class="m">40</span> <span class="err">-</span><span class="m">15</span>
        <span class="err">yLinear</span> <span class="m">15</span> <span class="err">-</span><span class="m">15</span> <span class="m">15</span>
        <span class="err">yLinear</span>  <span class="m">5</span>  <span class="m">15</span> <span class="m">40</span>

        <span class="err">zplanes</span> <span class="err">-</span><span class="m">50</span> <span class="err">-</span><span class="m">40</span> <span class="m">40</span> <span class="m">50</span> <span class="n">end</span>
        <span class="err">zLinear</span>  <span class="m">5</span> <span class="err">-</span><span class="m">40</span> <span class="err">-</span><span class="m">15</span>
        <span class="err">zLinear</span> <span class="m">15</span> <span class="err">-</span><span class="m">15</span> <span class="m">15</span>
        <span class="err">zLinear</span>  <span class="m">5</span>  <span class="m">15</span> <span class="m">40</span>
    <span class="n">end</span><span class="err"> </span><span class="n">gridGeometry</span>
<span class="n">end</span><span class="err"> </span><span class="n">definitions</span>
</pre></div>
</div>
<p>the description of the true source</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">sources</span>
    <span class="err">src</span> <span class="m">1</span>
        <span class="err">neutrons</span>  <span class="err">strength</span><span class="m">=4.05E+07</span>
        <span class="err">cuboid</span>  <span class="m">0</span><span class="err">.</span><span class="m">01</span> <span class="m">0</span><span class="err">.</span><span class="m">01</span>  <span class="m">0</span> <span class="m">0</span>  <span class="m">0</span> <span class="m">0</span>
        <span class="err">eDistributionID=</span><span class="m">1</span>
    <span class="n">end</span><span class="err"> </span><span class="n">src</span>
<span class="n">end</span><span class="err"> </span><span class="n">sources</span>
</pre></div>
</div>
<p>and finally the importance map block to trigger the Denovo calculation</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">001</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
<p>An optional shell command can be used to retrieve the cross section file and the Denovo input file (linux example shown below)</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="nf">=shell</span>
  <span class="err">cp</span> <span class="err">ft</span><span class="m">02</span><span class="err">f</span><span class="m">001</span>       <span class="err">${RTNDIR}/denovo</span><span class="m">1</span><span class="err">.ft</span><span class="m">02</span><span class="err">f</span><span class="m">001</span>
  <span class="err">cp</span> <span class="err">xkba_b.inp</span>     <span class="err">${RTNDIR}/denovo</span><span class="m">1</span><span class="err">.xkba.dsi</span>
<span class="n">end</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">denovo1.xkba.dsi</span></code> file (the Denovo simple input) contains both the source and mesh
geometry that MAVRIC prepared for Denovo, as shown in <a class="reference internal" href="#fig4c5"><span class="std std-numref">Fig. 52</span></a>.</p>
<div class="figure align-center" id="id17">
<span id="fig4c5"></span><img alt="_images/fig4c5.png" src="_images/fig4c5.png" />
<p class="caption"><span class="caption-number">Fig. 52 </span><span class="caption-text">Forward Denovo source (left) and mesh geometry (right).</span><a class="headerlink" href="#id17" title="Permalink to this image">¶</a></p>
</div>
<p>The result of the Denovo-only MAVRIC calculation is a file,
<code class="docutils literal notranslate"><span class="pre">denovo1.forward.dff</span></code>, containing the scalar fluxes for each energy group.
The Mesh File Viewer can be used to display each group or the total scalar flux, which is shown in <a class="reference internal" href="#fig4c6"><span class="std std-numref">Fig. 53</span></a>.</p>
<div class="figure align-center" id="id18">
<span id="fig4c6"></span><img alt="_images/fig4c6.png" src="_images/fig4c6.png" />
<p class="caption"><span class="caption-number">Fig. 53 </span><span class="caption-text">Total forward fluxes.</span><a class="headerlink" href="#id18" title="Permalink to this image">¶</a></p>
</div>
<p>The MAVRIC utilities can be used to further process the Denovo flux into
a detector response. The fluxes at the location of the detector need to
be multiplied by the photon flux-to-dose conversion factors (the
response function) and then summed. This is can be done in the same
input file using</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="nf">=dffResp</span>
<span class="s">&quot;denovo1.forward.dff&quot;</span>
<span class="m">1</span>
<span class="m">27</span>
<span class="m">1.6151395E-04</span>
<span class="m">1.4451494E-04</span>
<span class="m">1.2703618E-04</span>
<span class="m">1.2810882E-04</span>
<span class="m">1.2983654E-04</span>
<span class="m">1.0343020E-04</span>
<span class="m">5.2655141E-05</span>
<span class="m">1.2860853E-05</span>
<span class="m">3.7358122E-06</span>
<span class="m">3.7197628E-06</span>
<span class="m">4.0085556E-06</span>
<span class="m">4.2945048E-06</span>
<span class="m">4.4731187E-06</span>
<span class="m">4.5656334E-06</span>
<span class="m">4.5597271E-06</span>
<span class="m">4.5209654E-06</span>
<span class="m">4.4872718E-06</span>
<span class="m">4.4659614E-06</span>
<span class="m">4.4342228E-06</span>
<span class="m">4.3315831E-06</span>
<span class="m">4.2027596E-06</span>
<span class="m">4.0974155E-06</span>
<span class="m">3.8398102E-06</span>
<span class="m">3.6748431E-06</span>
<span class="m">3.6748440E-06</span>
<span class="m">3.6748431E-06</span>
<span class="m">3.6748447E-06</span>
<span class="s">&quot;denovo1.doses.dff&quot;</span>
<span class="n">end</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="nf">=dffInt</span>
<span class="s">&quot; denovo1.doses.dff&quot;</span>
<span class="m">1</span>
<span class="s">&quot; denovo1.total.dff&quot;</span>
<span class="n">end</span>


<span class="nf">=dffPull</span>
<span class="s">&quot; denovo1.total.dff&quot;</span>
<span class="m">1</span>
<span class="m">110</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span>
<span class="m">0</span>
<span class="s">&quot;denovo1.detectorDose.txt&quot;</span>
<span class="n">end</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>and results in a neutron dose rate of 5.426×10<sup>-3</sup> rem/hr,
calculated in about 2 minutes. Other combinations of the MAVRIC
utilities can be used to simply “pull” out the fluxes from the detector
location and then use a spreadsheet to compute the dose rate. With
upscatter on, the result is 5.424×10<sup>-3</sup> rem/hr, showing that
upscatter does not contribute to dose rate at the detector. Note that
with upscatter on, the Denovo calculation required 81 minutes.</p>
</div>
<div class="section" id="adjoint">
<h4>Adjoint<a class="headerlink" href="#adjoint" title="Permalink to this headline">¶</a></h4>
<p>For the same calculation of neutron dose as above, a Denovo adjoint
calculation can be performed. The input file (<code class="docutils literal notranslate"><span class="pre">denovo2.inp</span></code>) has the same
composition, geometry, definitions, and source blocks as the forward
example. The adjoint input importance map block contains a description
of the adjoint source</p>
<div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="n">read</span><span class="err"> </span><span class="n">importanceMap</span>
    <span class="err">adjointSource</span> <span class="m">1</span>
        <span class="err">locationID=</span><span class="m">1</span>
        <span class="err">responseID=</span><span class="m">5</span>
    <span class="n">end</span><span class="err"> </span><span class="n">adjointSource</span>
    <span class="err">gridGeometryID=</span><span class="m">7</span>
    <span class="err">mmTolerance=</span><span class="m">0</span><span class="err">.</span><span class="m">001</span>
<span class="n">end</span><span class="err"> </span><span class="n">importanceMap</span>
</pre></div>
</div>
<p>The result of this Denovo-only MAVRIC calculation is a file,
<code class="docutils literal notranslate"><span class="pre">denovo2.adjoint.dff</span></code>, containing the scalar adjoint fluxes for each
energy group, as shown in <a class="reference internal" href="#fig4c7"><span class="std std-numref">Fig. 54</span></a>.</p>
<div class="figure align-center" id="id19">
<span id="fig4c7"></span><img alt="_images/fig4c7.png" src="_images/fig4c7.png" />
<p class="caption"><span class="caption-number">Fig. 54 </span><span class="caption-text">Total adjoint fluxes.</span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</div>
<p>As with the forward fluxes, the MAVRIC utilities can be used to further
process the Denovo adjoint fluxes into a detector response. The adjoint
fluxes at the location of the forward source need to be multiplied by
the source distribution and strength and then summed. This is can be
done using</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="nf">=dffResp</span>
<span class="s">&quot;denovo2.adjoint.dff&quot;</span>
<span class="m">1</span>
<span class="m">27</span>
<span class="m">3.365455E-02</span>
<span class="m">2.398546E-01</span>
<span class="m">2.398289E-01</span>
<span class="m">1.085244E-01</span>
<span class="m">1.527957E-01</span>
<span class="m">1.463752E-01</span>
<span class="m">6.669337E-02</span>
<span class="m">1.164470E-02</span>
<span class="m">5.713197E-04</span>
<span class="m">5.240384E-05</span>
<span class="m">4.470401E-06</span>
<span class="m">2.956226E-07</span>
<span class="m">4.160008E-08</span>
<span class="m">1.011605E-08</span>
<span class="m">9.667897E-10</span>
<span class="m">3.579175E-10</span>
<span class="m">9.880883E-11</span>
<span class="m">6.634570E-11</span>
<span class="m">9.742191E-11</span>
<span class="m">1.538334E-10</span>
<span class="m">2.777230E-11</span>
<span class="m">2.690255E-11</span>
<span class="m">2.572180E-11</span>
<span class="m">7.001169E-12</span>
<span class="m">2.049478E-12</span>
<span class="m">1.437105E-12</span>
<span class="m">3.424200E-13</span>
<span class="s">&quot;denovo2.doses.dff&quot;</span>
<span class="n">end</span>
</pre></div>
</div>
</td>
<td><div class="highlight-scale notranslate"><div class="highlight"><pre><span></span><span class="nf">=dffMult</span>
<span class="s">&quot; denovo2.doses.dff&quot;</span><span class="m"></span>
<span class="m">4.05E+07</span>
<span class="s">&quot; denovo2.doses.dff&quot;</span>
<span class="n">end</span>


<span class="nf">=dffInt</span>
<span class="s">&quot; denovo2.doses.dff&quot;</span>
<span class="m">1</span>
<span class="s">&quot; denovo2.total.dff&quot;</span>
<span class="n">end</span>


<span class="nf">=dffPull</span>
<span class="s">&quot; denovo2.total.dff&quot;</span>
<span class="m">1</span>
<span class="m">0</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span> <span class="m">0</span><span class="err">.</span><span class="m">0</span>
<span class="m">0</span>
<span class="s">&quot;denovo2.detectorDose.txt&quot;</span>
<span class="n">end</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>and results in a neutron dose rate of 5.463×10<sup>-3</sup> rem/hr.</p>
<p>The results of the example problems above used a fairly coarse mesh
(44×27×27) and the default values of S<sub>8</sub> and P<sub>3</sub>. Run
times were 2 minutes for the forward case and 2.5 minutes for the
adjoint. With a finer mesh, larger quadrature order and larger numbers
of Legendre moments for the scattering representation, the values
calculated using Denovo should converge towards the Monte Carlo
solution of
1.494×10<sup>-2</sup> rem/hr ± 1.2%.</p>
<p id="bibtex-bibliography-appendixc-0"><dl class="citation">
<dt class="bibtex label" id="becker-hybrid-2009"><span class="brackets"><a class="fn-backref" href="#id6">Bec09</a></span></dt>
<dd><p>T. L. Becker. <em>Hybrid Monte Carlo/Deterministic Methods for Deep-Penetration Problems</em>. PhD thesis, University of Michigan, 2009.</p>
</dd>
<dt class="bibtex label" id="becker-application-2009"><span class="brackets"><a class="fn-backref" href="#id5">BL09</a></span></dt>
<dd><p>T. L. Becker and E. W. Larsen. The application of weight windows to ‘global’monte carlo problems. In <em>Proc. Conf. Advances in Mathematics, Computational Methods, and Reactor Physics</em>. American Nuclear Society Saratoga Springs, New York, 2009.</p>
</dd>
<dt class="bibtex label" id="cooper-automated-2001"><span class="brackets"><a class="fn-backref" href="#id4">CL01</a></span></dt>
<dd><p>Marc A. Cooper and Edward W. Larsen. Automated weight windows for global Monte Carlo particle transport calculations. <em>Nuclear science and engineering</em>, 137(1):1–13, 2001. Publisher: Taylor &amp; Francis.</p>
</dd>
<dt class="bibtex label" id="evans-denovo-2010"><span class="brackets"><a class="fn-backref" href="#id11">ESSC10</a></span></dt>
<dd><p>Thomas M. Evans, Alissa S. Stafford, Rachel N. Slaybaugh, and Kevin T. Clarno. Denovo: A new three-dimensional parallel discrete ordinates code in SCALE. <em>Nuclear technology</em>, 171(2):171–200, 2010. Publisher: Taylor &amp; Francis.</p>
</dd>
<dt class="bibtex label" id="peplow-comparison-2013"><span class="brackets">Pep13</span><span class="fn-backref">(<a href="#id8">1</a>,<a href="#id10">2</a>)</span></dt>
<dd><p>Douglas E. Peplow. Comparison of hybrid methods for global variance reduction in shielding calculations. In <em>Proceedings of the 2013 International Conference on Mathematics and Computational Methods Applied to Nuclear Science and Engineering-M and C 2013</em>. 2013.</p>
</dd>
<dt class="bibtex label" id="peplow-consistent-2012"><span class="brackets"><a class="fn-backref" href="#id3">PME12</a></span></dt>
<dd><p>Douglas E. Peplow, Scott W. Mosher, and Thomas M. Evans. Consistent Adjoint Driven Importance Sampling Using Space, Energy and Angle. <em>ORNL/TM-2012/7, Oak Ridge National Laboratory</em>, 2012. Publisher: Citeseer.</p>
</dd>
<dt class="bibtex label" id="peplow-hybrid-2010"><span class="brackets"><a class="fn-backref" href="#id2">PMEW10</a></span></dt>
<dd><p>Douglas E. Peplow, Scott W. Mosher, Thomas M. Evans, and J. C. Wagner. Hybrid Monte Carlo/Deterministic Methods for Streaming/Beam Problems. In <em>American Nuclear Society Radiation Protection and Shielding Division 2010 Topical Meeting, Las Vegas, Nevada</em>. 2010.</p>
</dd>
<dt class="bibtex label" id="van-riper-avatar-1997"><span class="brackets"><a class="fn-backref" href="#id1">VRUS97</a></span></dt>
<dd><p>K. A. Van Riper, T. J. Urbatsch, and P. D. Soran. AVATAR – Automatic variance reduction in Monte Carlo calculations. Technical Report LA-UR-97-919; CONF-971005-10, Los Alamos National Lab., NM (United States), May 1997. URL: <a class="reference external" href="https://www.osti.gov/biblio/527548">https://www.osti.gov/biblio/527548</a>.</p>
</dd>
<dt class="bibtex label" id="van-wijk-easy-2011"><span class="brackets"><a class="fn-backref" href="#id9">VWVdEH11</a></span></dt>
<dd><p>A. J. Van Wijk, Gert Van den Eynde, and J. E. Hoogenboom. An easy to implement global variance reduction procedure for MCNP. <em>Annals of Nuclear Energy</em>, 38(11):2496–2503, 2011. Publisher: Elsevier.</p>
</dd>
</dl>
</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Monte%20Carlo%20Transport%20Overview.html" class="btn btn-neutral float-right" title="Monte Carlo Transport Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="appendixb.html" class="btn btn-neutral float-left" title="MAVRIC Appendix B: MAVRIC Utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, SCALE developers

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>